ДОБАВИТЬКОНТЕКСТ("SELECT КодВидаПродукции, ИДПроизвИмп, ВидПродукции, НаименованиеПроизводителя, ИННПроизводителя, КПППроизводителя, 						 SUM( ОстатокНаНачало ) AS ОстатокНаНачало, SUM( ПоступлениеОтПроизводителей ) AS ПоступлениеОтПроизводителей, 						 SUM( ПоступлениеОтОптовиков ) AS ПоступлениеОтОптовиков, SUM( ПоступлениеПоИмпорту ) AS ПоступлениеПоИмпорту, 						 SUM( ВозвратОтПокупателей ) AS ВозвратОтПокупателей, SUM( ПрочееПоступление ) AS ПрочееПоступление, 						 SUM( ПоступлениеОтПроизводителей + ПоступлениеОтОптовиков + ПоступлениеПоИмпорту ) AS ИтогоПоступлений,						 SUM( ПоступлениеОтПроизводителей + ПоступлениеОтОптовиков + ПоступлениеПоИмпорту + ВозвратОтПокупателей + ПрочееПоступление + 						 ПоступлениеПоПеремещению ) AS ВсегоПоступлений, SUM( РасходРозница + РасходПрочий + РасходВозвратПоставщику + РасходПеремещение ) AS ВсегоРасход,						 " + ЕСЛИ( ПУСТО( ПОДРАЗДЕЛЕНИЕ ), "CASE WHEN SUM( ПоступлениеПоПеремещению ) > SUM( РасходПеремещение )																	   THEN SUM( ПоступлениеПоПеремещению ) - SUM( РасходПеремещение ) ELSE 0 END", "SUM( ПоступлениеПоПеремещению )" ) + " AS ПоступлениеПоПеремещению, 						 " + ЕСЛИ( ПУСТО( ПОДРАЗДЕЛЕНИЕ ), "CASE WHEN SUM( РасходПеремещение ) > SUM( ПоступлениеПоПеремещению )																	   THEN SUM( РасходПеремещение ) - SUM( ПоступлениеПоПеремещению ) ELSE 0 END", "SUM( РасходПеремещение )" ) + " AS РасходПеремещение, 						SUM( РасходРозница ) AS РасходРозница, SUM( РасходПрочий ) AS РасходПрочий, SUM( РасходВозвратПоставщику ) AS РасходВозвратПоставщику, SUM( ОстатокНаКонец ) AS ОстатокНаКонец				 FROM " + ТаблицаДвижений + " 				 WHERE " + ЕСЛИ( ПУСТО( ПОДРАЗДЕЛЕНИЕ ), "", "Подразделение = '" + ПОДРАЗДЕЛЕНИЕ + "' AND " ) + "						( ROUND( ОстатокНаНачало, 5 ) <> 0 OR ROUND( ПоступлениеОтПроизводителей, 5 ) <> 0 OR ROUND( ПоступлениеОтОптовиков, 5 ) <> 0 OR						  ROUND( ПоступлениеПоИмпорту, 5 ) <> 0 OR ROUND( ВозвратОтПокупателей, 5 ) <> 0 OR ROUND( ПрочееПоступление, 5 ) <> 0 OR 						  ROUND( ISNULL( ПоступлениеОтПроизводителей, 0 ) + ISNULL( ПоступлениеОтОптовиков, 0 ) + ISNULL( ПоступлениеПоИмпорту, 0 ), 5 ) <> 0 OR 						  ROUND( ISNULL( ПоступлениеОтПроизводителей, 0 ) + ISNULL( ПоступлениеОтОптовиков, 0 ) + ISNULL( ПоступлениеПоИмпорту, 0 ) +								 ISNULL( ВозвратОтПокупателей, 0 ) + ISNULL( ПрочееПоступление, 0 ) + ISNULL( ПоступлениеПоПеремещению, 0 ), 5 ) <> 0 OR 						  ROUND( ISNULL( РасходРозница, 0 ) + ISNULL( РасходПрочий, 0 ) + ISNULL( РасходВозвратПоставщику, 0 ) + ISNULL( РасходПеремещение, 0 ), 5 ) <> 0 OR						  ROUND( ПоступлениеПоПеремещению, 5 ) <> 0 OR ROUND( РасходРозница, 5 ) <> 0 OR ROUND( РасходПрочий, 5 ) <> 0 OR 						  ROUND( РасходВозвратПоставщику, 5 ) <> 0 OR ROUND( РасходПеремещение, 5 ) <> 0 OR ROUND( ОстатокНаКонец, 5 ) <> 0 )				 GROUP BY КодВидаПродукции, ИДПроизвИмп, ВидПродукции, НаименованиеПроизводителя, ИННПроизводителя, КПППроизводителя				 ORDER BY 1, 2, 3", "СписокТоваров"  );
