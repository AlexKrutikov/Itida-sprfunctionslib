
// Функция разбора XML файла с УПД
Имя								= UPPER( ALLTRIM( Имя ) );
IF ( ТипТэга == "ТЭГ" AND !ФлагЗакрытия )
{
	
	IF ( Имя == "СВУЧДОКОБОР" )
	{
		Состояние				= "СвУчДокОбор";
		ТекущийОбъект			= "";
		ПродавецЭДОИД			= "";
		ПолучательЭДОИД			= "";
	}
	ELSE IF ( Имя == "СВСЧФАКТ" )
	{
		Состояние				= "СвСчФакт";
		ТекущийОбъект			= "";
		Номер 					= "";
		Дата 					= {};
		ПродавецНаименование 	= "";
		ПродавецИНН 			= "";
		ПродавецКПП 			= "";
		ПродавецАдрес 			= "";
		ПродавецСчет 			= "";
		ПродавецБанк 			= "";
		Грузополучатель			= "";
		ГрузополучательКПП		= "";
		ПолучательНаименование 	= "";
		ПолучательИНН 			= "";
		ПолучательКПП 			= "";
		Сумма 					= 0.00;
		СуммаБезНДС				= 0.00;
	}
	ELSE IF ( Имя == "СВПРОД" )
	{
		Состояние				= "СвПрод";
		ТекущийОбъект			= "Продавец";
	}
	ELSE IF ( Имя == "СВПОКУП" )
	{
		Состояние				= "СвПокуп";
		ТекущийОбъект			= "Покупатель";
	}
	ELSE IF ( Имя == "ГРУЗПОЛУЧ" )
	{
		Состояние				= "ГрузПолуч";
		ТекущийОбъект			= "Грузополучатель";
	}
	ELSE IF ( Имя == "ИДСВ" )
		Состояние				= "ИдСв";
	ELSE IF ( Имя == "АДРЕС" )
		Состояние				= "Адрес";
	ELSE IF ( Имя == "БАНКРЕКВ" )
		Состояние				= "БАНКРЕКВ";
	ELSE IF ( Имя == "СВЕДТОВ" )
	{
		НомерСтроки 			= 0;
		НаименованиеТовара 		= "";
		Единица 				= "";
		ОКЕИ 					= "";
		Налог					= 0.00;
		Количество 				= 0.00;
		Сумма 					= 0.00;
		СуммаБезНДС				= 0.00;
		ШтрихКод 				= "";
		Состояние				= "";
		ТекущийОбъект			= "Товар";
	}
	ELSE IF ( Имя == "ИНФПОЛФХЖ2" )
		Состояние				= "ИНФПОЛФХЖ2";
}
IF ( ТипТэга == "ТЭГ" AND ФлагЗакрытия )
{
	IF ( Имя == "ДОКУМЕНТ" )
	{
		ДОБАВИТЬСТРОКИ( 1, "Документ" );
		ИЗМЕНИТЬПОЛЕ( "Документ", "Номер", Номер );
		ИЗМЕНИТЬПОЛЕ( "Документ", "Дата", Дата );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецНаименование", ПродавецНаименование );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецИНН", ПродавецИНН );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецКПП", ПродавецКПП );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецАдрес", ПродавецАдрес );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецСчет", ПродавецСчет );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецБанк", ПродавецБанк );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПродавецЭДОИД", ПродавецЭДОИД );
		ИЗМЕНИТЬПОЛЕ( "Документ", "Грузополучатель", Грузополучатель );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ГрузополучательКПП", ГрузополучательКПП );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПолучательНаименование", ПолучательНаименование );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПолучательИНН", ПолучательИНН );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПолучательКПП", ПолучательКПП );
		ИЗМЕНИТЬПОЛЕ( "Документ", "ПолучательЭДОИД", ПолучательЭДОИД );
		ИЗМЕНИТЬПОЛЕ( "Документ", "Сумма", Сумма );
		ИЗМЕНИТЬПОЛЕ( "Документ", "СуммаБезНДС", СуммаБезНДС );
		
		Состояние				= "";
		ТекущийОбъект			= "";
	}
	ELSE IF ( Имя == "СВПРОД" )
	{
		Состояние				= "";
		ТекущийОбъект			= "";
	}
	ELSE IF ( Имя == "СВПОКУП" )
	{
		Состояние				= "";
		ТекущийОбъект			= "";
	}
	ELSE IF ( Имя == "СВЕДТОВ" )
	{
		ДОБАВИТЬСТРОКИ( 1, "СтрокиДокумента" );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "НомерСтроки", НомерСтроки );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "НаименованиеТовара", НаименованиеТовара );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "Единица", Единица );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "ОКЕИ", ОКЕИ );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "Количество", Количество );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "Сумма", Сумма );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "СуммаБезНДС", СуммаБезНДС );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "ШтрихКод", ШтрихКод );
		ИЗМЕНИТЬПОЛЕ( "СтрокиДокумента", "Налог", Налог );

		Состояние				= "";
		ТекущийОбъект			= "";
	}
	ELSE IF ( ВСПИСКЕ( Имя, "КИЗ", "ИДЕНТТРАНСУПАК", "НОМУПАК" ) )
	{
		ДОБАВИТЬСТРОКИ( 1, "Марки" );
		ИЗМЕНИТЬПОЛЕ( "Марки", "НомерСтроки", НомерСтроки );
		ИЗМЕНИТЬПОЛЕ( "Марки", "Марка", Сервис.КИЗИзЗначения( Значение ) );
	}
	ELSE IF ( Имя == "ИНФПОЛФХЖ2" )
		Состояние				= "";
}
ELSE IF ( ТипТэга == "АТРИБУТ" )
{
	IF ( Имя == "ИДОТПР" AND Состояние == "СвУчДокОбор" )
		ПродавецЭДОИД			= Значение;
	ELSE IF ( Имя == "ИДПОЛ" AND Состояние == "СвУчДокОбор" )
		ПолучательЭДОИД			= Значение;
	ELSE IF ( Имя == "НОМЕРСЧФ" )
		Номер					= Значение;
	ELSE IF ( Имя == "ДАТАСЧФ" )
		Дата					= CTOD( Значение );
	ELSE IF ( Имя == "НАИМОРГ" )
	{
		IF ( ТекущийОбъект == "Продавец" ) 
			ПродавецНаименование	= Значение;
		ELSE IF ( ТекущийОбъект == "Покупатель" ) 
			ПолучательНаименование	= Значение;
	}
	ELSE IF ( ВСПИСКЕ( Имя, "ФАМИЛИЯ", "ИМЯ", "ОТЧЕСТВО" ) )
	{
		IF ( ТекущийОбъект == "Продавец" ) 
			ПродавецНаименование	+= ЕСЛИ( !ПУСТО( ПродавецНаименование ), " ", "" ) + Значение;
		ELSE IF ( ТекущийОбъект == "Покупатель" ) 
			ПолучательНаименование	+= ЕСЛИ( !ПУСТО( ПолучательНаименование ), " ", "" ) + Значение;
	}
	ELSE IF ( ВСПИСКЕ( Имя, "ИННЮЛ", "ИННФЛ" ) )
	{
		IF ( ТекущийОбъект == "Продавец" ) 
			ПродавецИНН				= Значение;
		ELSE IF ( ТекущийОбъект == "Покупатель" ) 
			ПолучательИНН			= Значение;
	}
	ELSE IF ( Имя == "КПП" )
	{
		IF ( ТекущийОбъект == "Продавец" ) 
			ПродавецКПП				= Значение;
		ELSE IF ( ТекущийОбъект == "Покупатель" ) 
			ПолучательКПП			= Значение;
		ELSE IF ( ТекущийОбъект == "Грузополучатель" ) 
			ГрузополучательКПП		= Значение;
	}
	ELSE IF ( ВСПИСКЕ( Имя, "ИНДЕКС", "КОДРЕГИОН", "РАЙОН", "ГОРОД", "НАСЕЛЕННЫЙПУНКТ", "УЛИЦА", "ДОМ", "КОРПУС", "КВАРТИРА" ) )
	{
		IF ( ТекущийОбъект == "Продавец" ) 
			ПродавецАдрес			+= ЕСЛИ( !ПУСТО( ПродавецАдрес ), ",", "" )	+ Значение;
		IF ( ТекущийОбъект == "Грузополучатель" ) 
			Грузополучатель			+= ЕСЛИ( !ПУСТО( Грузополучатель ), ",", "" )	+ Значение;
	}
	ELSE IF ( Имя ==  "НОМЕРСЧЕТА" AND ТекущийОбъект == "Продавец" )
		ПродавецСчет				= Значение;
	ELSE IF ( Имя ==  "БИК" AND ТекущийОбъект == "Продавец" )
		ПродавецБанк				= Значение;
	ELSE IF ( Имя ==  "СТТОВУЧНАЛВСЕГО" )
		Сумма						= VAL( Значение );
	ELSE IF ( Имя ==  "СТТОВБЕЗНДСВСЕГО" )
		СуммаБезНДС					= VAL( Значение );
	ELSE IF ( Имя ==  "НОМСТР" AND ТекущийОбъект == "Товар" )
		НомерСтроки					= VAL( Значение );
	ELSE IF ( Имя ==  "НАИМТОВ" AND ТекущийОбъект == "Товар" )
		НаименованиеТовара			= Значение;
	ELSE IF ( Имя ==  "ОКЕИ_ТОВ" AND ТекущийОбъект == "Товар" )
		ОКЕИ						= Значение;
	ELSE IF ( Имя ==  "НАЛСТ" AND ТекущийОбъект == "Товар" )
		Налог						= VAL( Значение );
	ELSE IF ( Имя ==  "КОЛТОВ" AND ТекущийОбъект == "Товар" )
		Количество 					= VAL( Значение );
	ELSE IF ( Имя ==  "СТТОВУЧНАЛ" AND ТекущийОбъект == "Товар" )
		Сумма	 					= VAL( Значение );
	ELSE IF ( Имя ==  "СТТОВБЕЗНДС" AND ТекущийОбъект == "Товар" )
		СуммаБезНДС					= VAL( Значение );
	ELSE IF ( Имя ==  "НАИМЕДИЗМ" AND ТекущийОбъект == "Товар" )
		Единица 					= Значение;
	ELSE IF ( Имя ==  "ИДЕНТИФ" AND ТекущийОбъект == "Товар" AND Состояние == "ИНФПОЛФХЖ2" AND UPPER( ALLTRIM( Значение ) ) == "ШТРИХКОД" )
		Состояние 					= "ШТРИХКОД";
	ELSE IF ( Имя ==  "ЗНАЧЕН" AND ТекущийОбъект == "Товар" AND Состояние == "ШТРИХКОД" )
		ШтрихКод 					= Значение;
	ELSE IF ( ВСПИСКЕ( Имя, "КИЗ", "ИДЕНТТРАНСУПАК", "НОМУПАК" ) )
	{
		ДОБАВИТЬСТРОКИ( 1, "Марки" );
		ИЗМЕНИТЬПОЛЕ( "Марки", "НомерСтроки", НомерСтроки );
		ИЗМЕНИТЬПОЛЕ( "Марки", "Марка", Сервис.КИЗИзЗначения( Значение ) );
	}
}
