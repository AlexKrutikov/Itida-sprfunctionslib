
Версия2ЕГАИС		= VAL( ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'EGAIS_VERSION2" + СКЛАД + "'" ) ) > 0;

// Проверяем накладные, возможно, по некоторым уже были отправлены акты
ДОБАВИТЬКОНТЕКСТ( "SELECT ndok, date FROM spr002 WHERE egaisid = '' AND identity_column IN ( SELECT ic FROM " + ИМЯТАБЛИЦЫ + " )", "СписокНакладных" );
ТекстСообщения		= "";
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокНакладных" ) )
{
	ТекстСообщения	+= СписокНакладных.ndok + " от " + DTOC( СписокНакладных.date ) + CHR( 13 );
	ПРОПУСТИТЬ( 1, "СписокНакладных" );
}
УДАЛИТЬКОНТЕКСТ( "СписокНакладных" );
IF ( !ПУСТО( ТекстСообщения ) )
	IF ( СООБЩЕНИЕ( "В следующих накладных не указан идентификатор из ЕГАИС. " + CHR( 13 ) + "По этим накладным не будут отправлены акты." + CHR( 13 ) + "Продолжить? " + CHR( 13 ) + ТекстСообщения, "Отправка актов", 4 ) != 6 ) RETURN false;

// Проходим по списку отмеченных документов и отправляем акты
ДОБАВИТЬКОНТЕКСТ( "SELECT ic FROM " + ИМЯТАБЛИЦЫ, "СписокДокументов" );
IF ( КОЛИЧЕСТВОСТРОК( "СписокДокументов" ) == 0 )
{
	СООБЩЕНИЕ( "Необходимо отметить хотя бы одну накладную, для отправки акта по ней.", "Отправка актов" );
	RETURN false;
}
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокДокументов" ) )
{
	Версия2ЕГАИСКлиента	= ЗАПРОС( "SELECT egaisversion FROM sprclient WHERE code = (SELECT client FROM spr002 WHERE identity_column = " + СписокДокументов.ic + " )" ) > 1; 
	IF ( !ЕГАИС.ОтправитьАКТОтменыНакладной_В3( СписокДокументов.ic ) ) RETURN false;
	ПРОПУСТИТЬ( 1, "СписокДокументов" );
}
УДАЛИТЬКОНТЕКСТ( "СписокДокументов" );
RETURN true;
