	Версия2ЕГАИС		= VAL( ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'EGAIS_VERSION2" + СКЛАД + "'" ) ) > 0;Версия3ЕГАИС		= VAL( ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'EGAIS_VERSION3" + СКЛАД + "'" ) ) > 0;// Формируем список наклданых для отправкиДОБАВИТЬКОНТЕКСТ( "SELECT ndok, date FROM spr043 WHERE egaisstatus >= 2 AND identity_column IN ( SELECT ic FROM " + ИМЯТАБЛИЦЫ + " )", "СписокАктов" );ТекстСообщения		= "";WHILE ( !КОНЕЦКОНТЕКСТА( "СписокАктов" ) ){	ТекстСообщения	+= СписокАктов.ndok + " от " + DTOC( СписокАктов.date ) + CHR( 13 );	ПРОПУСТИТЬ( 1, "СписокАктов" );}УДАЛИТЬКОНТЕКСТ( "СписокАктов" );IF ( !ПУСТО( ТекстСообщения ) )	IF ( СООБЩЕНИЕ( "Следующие акты постановки на баланс уже были отправлены в ЕГАИС. Продолжить? " + CHR( 13 ) + ТекстСообщения, "Отправка актов", 4 ) != 6 ) RETURN false;// Проходим по списку отмеченных документов и отправляем их в ЕГАИСДОБАВИТЬКОНТЕКСТ( "SELECT temp.ic, spr.egaisstatus , spr.doctype				   FROM " + ИМЯТАБЛИЦЫ + " temp				   INNER JOIN spr043 spr ON temp.ic = spr.identity_column", "СписокДокументов" );IF ( КОЛИЧЕСТВОСТРОК( "СписокДокументов" ) == 0 ){	СООБЩЕНИЕ( "Необходимо отметить хотя бы один акт, для отправки.", "Отправка актов" );	RETURN false;}WHILE ( !КОНЕЦКОНТЕКСТА( "СписокДокументов" ) ){	Результат	= true;	IF ( СписокДокументов.doctype == "001" )		Результат		= ЕСЛИ( Версия3ЕГАИС, !ЕГАИС.ОтправитьАКТПОСТАНОВКИНАБАЛАНС_В2( СписокДокументов.ic ), !ЕГАИС.ОтправитьАКТПОСТАНОВКИНАБАЛАНС_В2( СписокДокументов.ic ) );	ELSE IF ( СписокДокументов.doctype == "002" )		Результат		= ЕГАИС.ОТПРАВИТЬАктФиксацииМарок_В3( СписокДокументов.ic );	ELSE IF ( СписокДокументов.doctype == "003" )		Результат		= ЕГАИС.ОТПРАВИТЬАктОТМЕНЫФиксацииМарок_В3( СписокДокументов.ic );			IF ( !Результат ) return false;		ПРОПУСТИТЬ( 1, "СписокДокументов" );}УДАЛИТЬКОНТЕКСТ( "СписокДокументов" );RETURN true;
