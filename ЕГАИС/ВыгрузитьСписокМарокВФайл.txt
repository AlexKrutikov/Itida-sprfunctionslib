НОМЕРФАЙЛА	= 0;
ФАЙЛ		= -1;
ШАБЛОНИМЕНИ	= ЗАМЕНИТЬ( ИМЯФАЙЛА, ".xml", "" );
ДОБАВИТЬКОНТЕКСТ( "SELECT mark AS barcode FROM " + ИМЯТАБЛИЦЫ, "СписокМарок" );
WHILE( !КОНЕЦКОНТЕКСТА( "СписокМарок" ) )
{
	// Разбиваем данные по сто марок
	IF ( НОМЕРСТРОКИ( "СписокМарок" ) % 100 == 0 ) 
	{
		IF ( ФАЙЛ != - 1)
		{
			ФАЙЛЗАПИСАТЬСТРОКУ( Файл, "</Marks>" );
			ФАЙЛЗАКРЫТЬ( Файл );
		}
		ИМЯФАЙЛА	= ШАБЛОНИМЕНИ + ЕСЛИ( НОМЕРФАЙЛА == 0, "", STR( НОМЕРФАЙЛА ) ) + ".xml";
		ФАЙЛ		= ФАЙЛСОЗДАТЬ( ИМЯФАЙЛА );
		IF ( ФАЙЛ < 0 )
		{
			СООБЩЕНИЕ( "Не удалось создать файл '" + ИМЯФАЙЛА + "'", "Выгрузка марок в файл.", 0 );
			RETURN false;
		}

		ФАЙЛЗАПИСАТЬСТРОКУ( Файл, "<?xml version='1.0' encoding='UTF-8' standalone='yes' ?>" );
		ФАЙЛЗАПИСАТЬСТРОКУ( Файл, "<Marks>" );
		НОМЕРФАЙЛА++;
	}
	ФАЙЛЗАПИСАТЬСТРОКУ( ФАЙЛ, "<Barcode>" + СписокМарок.barcode + "</Barcode>" );
	ПРОПУСТИТЬ( 1, "СписокМарок" );
}
ФАЙЛЗАПИСАТЬСТРОКУ( Файл, "</Marks>" );
ФАЙЛЗАКРЫТЬ( Файл );
УДАЛИТЬКОНТЕКСТ( "СписокМарок" );

СООБЩЕНИЕ( "Файл(ы) '" + ШАБЛОНИМЕНИ + "' успешно записан(ы).", "Выгрузка марок в файл.", 0 );
