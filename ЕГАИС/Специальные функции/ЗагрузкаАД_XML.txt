PUBLIC ЗАГРУЗКААД_XML_ВИД, ЗАГРУЗКААД_XML_ПРОИЗВОДИТЕЛЬ, ЗАГРУЗКААД_XML_ИНН, ЗАГРУЗКААД_XML_КПП;ФУНКЦИЯ ЛОКАЛЬНАЯ ЗАГРУЗКААД_XML_РАЗОБРАТЬТЭГИ( Родитель, ТипТэга, Имя, Значение, ФлагЗакрытия ){	IF ( ТипТэга == "ТЭГ" && !ФлагЗакрытия && UPPER( Имя ) == "ПРОДУКЦИЯ" ) 	{		ДОБАВИТЬСТРОКИ( 1, "ЛокальныеДанные" );		ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "П000000000003", ЗАГРУЗКААД_XML_ВИД );		ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "NAMEORG", ЗАГРУЗКААД_XML_ПРОИЗВОДИТЕЛЬ );		ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "INN", ЗАГРУЗКААД_XML_ИНН );		ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "KPP", ЗАГРУЗКААД_XML_КПП );	}	IF ( ТипТэга == "АТРИБУТ" || ( ТипТэга == "ТЭГ" && ФлагЗакрытия ) )	{		IF ( UPPER( Имя ) == "П000000000003" )	ЗАГРУЗКААД_XML_ВИД				= Значение;		IF ( UPPER( Имя ) == "NAMEORG" ) 		ЗАГРУЗКААД_XML_ПРОИЗВОДИТЕЛЬ	= Значение;		IF ( UPPER( Имя ) == "INN" ) 			ЗАГРУЗКААД_XML_ИНН				= Значение;		IF ( UPPER( Имя ) == "KPP" ) 			ЗАГРУЗКААД_XML_КПП				= Значение;		IF ( UPPER( Имя ) == "П200000000013" ) ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "П200000000013", ДАТАИЗСТРОКИ( Значение ) );		IF ( UPPER( Имя ) == "П200000000014" ) ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "П200000000014", Значение );		IF ( UPPER( Имя ) == "П200000000016" ) ИЗМЕНИТЬПОЛЕ( "ЛокальныеДанные", "П200000000016", VAL( Значение ) );	}}IF ( ПУСТО( ИмяФайла ) )	ИмяФайла		= ФАЙЛВЫБРАТЬ( 1, "Файлы XML|*.xml" );IF ( ПУСТО( ИмяФайла ) ) RETURN REPLICATE( "-", 10 );// Формируем таблицу из 100 полей для первоначальной загрузки данныхИмяВременнойТаблицы		= "##" + УНИКАЛЬНОЕИМЯ( );// Создаем временную таблицу для сбора номеров накладных и объемов поставкиЗАПРОС( "CREATE TABLE " + ИмяВременнойТаблицы + "( [П000000000003] varchar( 10 ), NameOrg varchar( 250 ), INN varchar( 250 ), KPP varchar( 250 ), [П200000000013] datetime, 												   [П200000000014] varchar( 250 ), [П200000000016] float, kolp float DEFAULT 0, identity_column int IDENTITY( 1, 1 ) )" );							ДОБАВИТЬКОНТЕКСТ( "SELECT * FROM " + ИмяВременнойТаблицы, "ЛокальныеДанные" );// Читаем файл в переменную, для разбора XMLФАЙЛXML					= ФАЙЛОТКРЫТЬ( ИмяФайла );Текст					= ФАЙЛПРОЧИТАТЬ( ФАЙЛXML, "S", 1000000 );ФАЙЛЗАКРЫТЬ( ФАЙЛXML );РАЗОБРАТЬ_XML( Текст, "ЗАГРУЗКААД_XML_РАЗОБРАТЬТЭГИ" );ВЫГРУЗИТЬ( ИмяВременнойТаблицы, "", "identity_column", "ЛокальныеДанные" );УДАЛИТЬКОНТЕКСТ( "ЛокальныеДанные" );// формируем итоги в разрезе вида продукцииТаблицаИтогов		= "##" + УНИКАЛЬНОЕИМЯ( );ЗАПРОС( "SELECT [П000000000003], [П200000000013], [П200000000014], SUM( [П200000000016] ) AS [П200000000016], CONVERT( float, 0 ) AS kolp		 INTO " + ТаблицаИтогов + "		 FROM " + ИмяВременнойТаблицы + "		 GROUP BY [П000000000003], [П200000000013], [П200000000014]" );		 RETURN ТаблицаИтогов;
