	
Версия2ЕГАИС		= false; //VAL( ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'EGAIS_VERSION2" + СКЛАД + "'" ) ) > 0;
Версия3ЕГАИС		= true; //VAL( ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'EGAIS_VERSION3" + СКЛАД + "'" ) ) > 0;

// Формируем список наклданых для отправки
ДОБАВИТЬКОНТЕКСТ( "SELECT ndok, date FROM spr003 WHERE egaisstatus >= 2 AND identity_column IN ( SELECT ic FROM " + ИМЯТАБЛИЦЫ + " )", "СписокАктов" );
ТекстСообщения		= "";
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокАктов" ) )
{
	ТекстСообщения	+= СписокАктов.ndok + " от " + DTOC( СписокАктов.date ) + CHR( 13 );
	ПРОПУСТИТЬ( 1, "СписокАктов" );
}
УДАЛИТЬКОНТЕКСТ( "СписокАктов" );
IF ( !ПУСТО( ТекстСообщения ) )
	IF ( СООБЩЕНИЕ( "Следующие акты списания продукции уже были отправлены в ЕГАИС. Продолжить? " + CHR( 13 ) + ТекстСообщения, "Отправка актов", 4 ) != 6 ) RETURN false;

// Проходим по списку отмеченных документов и отправляем их в ЕГАИС
ДОБАВИТЬКОНТЕКСТ( "SELECT temp.ic, spr.egaisstatus 
				   FROM " + ИМЯТАБЛИЦЫ + " temp
				   INNER JOIN spr003 spr ON temp.ic = spr.identity_column", "СписокДокументов" );
IF ( КОЛИЧЕСТВОСТРОК( "СписокДокументов" ) == 0 )
{
	СООБЩЕНИЕ( "Необходимо отметить хотя бы один акт, для отправки.", "Отправка актов" );
	RETURN false;
}
ТекстСообщенияПроМарки	= "";
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокДокументов" ) )
{
	IF ( ЕСЛИ( Версия3ЕГАИС, !ЕГАИС.ОтправитьАКТСПИСАНИЯПРОДУКЦИИ_В3( СписокДокументов.ic ), !ЕГАИС.ОтправитьАКТСПИСАНИЯПРОДУКЦИИ_В2( СписокДокументов.ic ) ) ) RETURN false;
	ПРОПУСТИТЬ( 1, "СписокДокументов" );
}
УДАЛИТЬКОНТЕКСТ( "СписокДокументов" );
IF ( !ПУСТО( ТекстСообщенияПроМарки ) ) СООБЩЕНИЕ( "Для следующей маркированной продукции " +  ТекстСообщенияПроМарки + CHR( 13 ) + 
												   "количество марок оказалось меньше списываемого количества." + CHR( 13 ) + 
												   "Документ(ы) не были отправлены в ЕГАИС.", "Отправка актов списания в ЕГАИС", 64 );

RETURN true;
