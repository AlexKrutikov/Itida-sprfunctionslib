Результат = 0;
/*
СООБЩЕНИЕ(	"ИДЧЕКА = " + ИДЧЕКА + CHR(13) + CHR(10) +
			"_ОПЕРАЦИЯ = " + _ОПЕРАЦИЯ + CHR(13) + CHR(10) +
			"МЕСТОВЫЗОВА = " + МЕСТОВЫЗОВА, "отладка - скрипт начисления");
*/			
IF ( МЕСТОВЫЗОВА == "ЗАПИСЬБОНУСА" AND _ОПЕРАЦИЯ != "ВОЗВРАТ" AND _ОПЕРАЦИЯ != "ВОЗВРАТПРИХОДА" )
{
	IF ( !RESTAPI.LOCARDS_СовершениеПокупки( ИДЧЕКА, НОМЕРКАРТЫ, ВСЕГОБОНУСОВ ) )
		СООБЩЕНИЕ("Не удалось провести операцю продажи в системе Locards", "LOCARDS");		
}
ELSE IF	( МЕСТОВЫЗОВА == "ЗАПИСЬБОНУСА" AND ( _ОПЕРАЦИЯ == "ВОЗВРАТ" OR _ОПЕРАЦИЯ == "ВОЗВРАТПРИХОДА" ) )
	RESTAPI.LOCARDS_УдалениеПокупки( ИДЧЕКА, _ИДЧЕКАОСНОВАНИЯ, НОМЕРКАРТЫ );
ELSE IF ( МЕСТОВЫЗОВА == "РАСЧЕТНАЧИСЛЕНИЙ" )
{
	РазмерКэшбэка = RESTAPI.Locards_РазмерКэшбэка( НОМЕРКАРТЫ, "", false );
	Результат = СуммаЧека * РазмерКэшбэка / 100;
}
ELSE IF ( МЕСТОВЫЗОВА == "РАСЧЕТСКИДКИ" )
	Результат = 0;
	
RETURN Результат;
