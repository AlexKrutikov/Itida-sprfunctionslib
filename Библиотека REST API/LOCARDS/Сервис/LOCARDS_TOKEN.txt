Токен = "";
//выберем данные по счетчику с типом бонуса LOCARDS и не пустым токеном в доп параметрах
ДОБАВИТЬКОНТЕКСТ( "SELECT code, name, dbo.fn_getchar_ex('SPR', 'SA7', 'LOCARDS_токен', code, '', '', '' ) AS token
					FROM sprbonus 
					WHERE bonusalias = 'LOCARDS'
					AND dbo.fn_getchar_ex('SPR', 'SA7', 'LOCARDS_токен', code, '', '', '' ) IS NOT NULL", "ТокеныЛокардс");

//если нет токена в доп параметрах счетчика бонусов с именем LOCARDS, то вернем токен из константы _LOCARDS_TOKEN
IF ( КОЛИЧЕСТВОСТРОК( "ТокеныЛокардс" ) == 0 ) RETURN ПЕРЕМЕННАЯ("_LOCARDS_TOKEN", "" );

ВЫБРАТЬКОНТЕКСТ( "ТокеныЛокардс" );
//если есть токен в доп параметрах, то берем первый и прерываем перебор контекста
WHILE ( !КОНЕЦКОНТЕКСТА( "ТокеныЛокардс" ) )
{
	Токен = ТокеныЛокардс.token;
	BREAK;
	ПРОПУСТИТЬ( 1, "ТокеныЛокардс");
}
УДАЛИТЬКОНТЕКСТ( "ТокеныЛокардс" );

RETURN Токен;
