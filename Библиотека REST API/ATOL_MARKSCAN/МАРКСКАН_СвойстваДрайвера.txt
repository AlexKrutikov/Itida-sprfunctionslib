ДанныеОТСД = RESTAPI.МАРКСКАН_ПолучитьИнформациюОбУстройстве( КОДОБОРУДОВАНИЯ );

IF ( !ПУСТО( ДанныеОТСД ) )
{
	СимвПС = CHR(13) + CHR(10);
	
	ПолеДокумент = ПОЛЕ_JSON( ДанныеОТСД, "document", "" );
	
	ИнфоУстройства = ПОЛЕ_JSON( ПолеДокумент, "cols", "");
	УстройствоНомер = ПОЛЕ_JSON( ИнфоУстройства, "device", "");
	УстройствоДатаПриложения = CTOD( ПОЛЕ_JSON( ИнфоУстройства, "date", ""), 7 );
	УстройствоХэшПриложения = ПОЛЕ_JSON( ИнфоУстройства, "hash", "");
	УстройствоВерсияПриложения = ПОЛЕ_JSON( ИнфоУстройства, "version", "");
	
	ДеталиУстройства = ПОЛЕ_JSON( ПолеДокумент, "details", "");
	МассивЛицензий = ПОЛЕ_JSON( ДеталиУстройства, "licenses", "");
	ЗАГРУЗИТЬJSON("СписокЛицензий", МассивЛицензий, "Лицензия");
	СтрокаЛицензии = "";
	WHILE ( !КОНЕЦКОНТЕКСТА("СписокЛицензий") )
	{
		ТипЛицензии = ПОЛЕ_JSON( СписокЛицензий.Лицензия, "type", "");
		ОкончаниеЛицензии = CTOD( ПОЛЕ_JSON( СписокЛицензий.Лицензия, "dtend", ""), 7 );
		
		СтрокаЛицензии += "Тип лицензии: " + ALLTRIM( ТипЛицензии ) + СимвПС;
		СтрокаЛицензии += "Срок действия лицензии: " + DTOC( ОкончаниеЛицензии, 4) + СимвПС;
		СтрокаЛицензии += СимвПС;
		
		ПРОПУСТИТЬ( 1, "СписокЛицензий");
	}
	
	СчетчикиДокументов = ПОЛЕ_JSON( ДеталиУстройства, "counter", "");
	ЗАГРУЗИТЬJSON("СписокДокументов", СчетчикиДокументов, "Документ");
	СтрокаДокументов = "";
	WHILE ( !КОНЕЦКОНТЕКСТА("СписокДокументов") )
	{
		ТипДокумента = ПОЛЕ_JSON( СписокДокументов.Документ, "type", "");
		ВсегоДокументов = ПОЛЕ_JSON( СписокДокументов.Документ, "total", "");
		ИмпортированоДокументов = ПОЛЕ_JSON( СписокДокументов.Документ, "imported", "");
		ЗавершеноДокументов = ПОЛЕ_JSON( СписокДокументов.Документ, "completed", "");
		
		НазваниеДокумента = "";
		IF ( ТипДокумента == "accept" ) //приёмка
			НазваниеДокумента = "ПРИЁМКА";
		ELSE IF ( ТипДокумента == "shipment" ) //отгрузка				
			НазваниеДокумента = "ОТГРУЗКА";
		ELSE IF ( ТипДокумента == "revaluation" )
			НазваниеДокумента = "ПЕРЕОЦЕНКА";
		ELSE IF ( ТипДокумента == "stocktaking" )
			НазваниеДокумента = "ИНВЕНТАРИЗАЦИЯ";
		ELSE IF ( ТипДокумента == "transfer" )
			НазваниеДокумента = "ПЕРЕМЕЩЕНИЕ";
		ELSE IF ( ТипДокумента == "return" )
			НазваниеДокумента = "ВОЗВРАТ";
		ELSE IF ( ТипДокумента == "barcodes" )
			НазваниеДокумента = "СБОР ШТРИХКОДОВ";
			
		СтрокаДокументов += НазваниеДокумента + ": ";
		СтрокаДокументов += "Всего: " + ВсегоДокументов + ЕСЛИ( !ПУСТО(ИмпортированоДокументов), ". Импортировано: " + ИмпортированоДокументов, "") + ЕСЛИ( !ПУСТО(ЗавершеноДокументов), ". Завершено: " + ЗавершеноДокументов, "") + СимвПС;
		//СтрокаДокументов += СимвПС;
		
		ПРОПУСТИТЬ( 1, "СписокДокументов");
	}
	
	СтрокаСвойстваТСД = "";
	СтрокаСвойстваТСД += "Atol Mark.Scan v" + ALLTRIM( УстройствоВерсияПриложения ) + СимвПС;
	СтрокаСвойстваТСД += "Дата и хэш приложения: " + DTOC( УстройствоДатаПриложения, 4) + " - " + УстройствоХэшПриложения + СимвПС;
	СтрокаСвойстваТСД += "Уникальный номер устройства: " + УстройствоНомер + СимвПС;
	СтрокаСвойстваТСД += СимвПС;
	IF ( !ПУСТО( СтрокаЛицензии ) )
	{
		СтрокаСвойстваТСД += "Данные о лицензиях: " + СимвПС;
		СтрокаСвойстваТСД += СтрокаЛицензии;
	}
	IF ( !ПУСТО( СтрокаДокументов ) )
	{
		СтрокаСвойстваТСД += "Данные о документах: " + СимвПС;
		СтрокаСвойстваТСД += СтрокаДокументов;
	}
	
	СООБЩЕНИЕ( СтрокаСвойстваТСД, RESTAPI.ИМЯОБОРУДОВАНИЯ());
}
ELSE
{
	СООБЩЕНИЕ("Не удалось получить информацию об устройстве", RESTAPI.ИМЯОБОРУДОВАНИЯ() );
}

RETURN true;
