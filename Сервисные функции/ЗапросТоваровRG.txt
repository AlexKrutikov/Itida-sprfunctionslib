
// Если в параметрах указан адрес внешнего хранилища, то сначала запрашиваем в нем
АдресСервера	= ЗАПРОС( "SELECT value FROM param WHERE param = 'externalwarehouseaddr'" );
ЛокальнаяТаблица= "##" + УНИКАЛЬНОЕИМЯ( );
IF ( VAL( ЗАПРОС( "SELECT value FROM param WHERE param = 'externalwarehouse'" ) ) > 0 && !ПУСТО( АдресСервера ) )
{
	Сервис.ЗапросТоваровИзХранилища( АдресСервера, ШК, ЛокальнаяТаблица, ТЕКСТОШИБКИ );
	ДОБАВИТЬКОНТЕКСТ( "SELECT value FROM " + ЛокальнаяТаблица + " WHERE type_ = 'name'", "СписокТоваров" );
	Единица		= STDF( ЗАПРОС( "SELECT MAX( value ) FROM " + ЛокальнаяТаблица + " WHERE type_ = 'ed'" ) );
	ТоварНайден	= КОЛИЧЕСТВОСТРОК( "СписокТоваров" ) > 0;
	WHILE( !КОНЕЦКОНТЕКСТА( "СписокТоваров" ) )
	{
		ЗАПРОС( "INSERT INTO " + ИМЯТАБЛИЦЫ + " ( title, units ) VALUES ( '" + STDF( СписокТоваров.value ) + "', '" + Единица + "' )" );
		ПРОПУСТИТЬ( 1, "СписокТоваров" );
	}
	УДАЛИТЬКОНТЕКСТ( "СписокТоваров" );
	IF ( ТоварНайден ) RETURN true;
}

IF ( ТИП( '_RGИМЯФАЙЛАЖУРНАЛА' ) == 'U' ) 
	_RGИМЯФАЙЛАЖУРНАЛА		= "";
	
_ERRORDESCRIPTION			= "";
ТЕКСТОШИБКИ					= "";
try 
{
	Соединение				= HTTPCONNECT( "https://api.ratengoods.com/data-api/itida/v0.10", 443, true, _RGИМЯФАЙЛАЖУРНАЛА );
	Заголовки[0]			= "Content-Type:application/json";
	АдресРесурса 			= "/product/?application_id=" + RGTOKEN + "&filter={""gtin"":""" + ШК + """}";
	Ответ 					= ПЕРЕКОДИРОВАТЬ( HTTPGET( Соединение, АдресРесурса, "Заголовки" ), "UTF-8", "ANSI" );
	//сообщение( Ответ );
	HTTPCLOSE( Соединение );
	ДОБАВИТЬКОНТЕКСТ( "SELECT * FROM " + ИМЯТАБЛИЦЫ, "Товары" );
	ЗАГРУЗИТЬ( "Товары", "JSON", Ответ );
	ВЫГРУЗИТЬ( ИМЯТАБЛИЦЫ, "", "", "Товары" );
	УДАЛИТЬКОНТЕКСТ( "Товары" );
}
catch
{
	ТЕКСТОШИБКИ				= _ERRORDESCRIPTION;
}
RETURN ПУСТО( ТЕКСТОШИБКИ );
