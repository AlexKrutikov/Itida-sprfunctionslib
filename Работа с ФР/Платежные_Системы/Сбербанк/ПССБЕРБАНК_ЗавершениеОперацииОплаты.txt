// отмена или подтверждение авторизации платежной системы
IF ( _ККТСУММАБЕЗНАЛ > 0 )
{
	IF ( TYPE("DriverPayCard") <> "O" )
		DriverPayCard = CreateObject( "SBRFSRV.Server", 1 );
	IF ( РезультатПечатиЧека == true )
	{
		IF ( ПЕРЕМЕННАЯ("_ИСПОЛЬЗОВАТЬНЕПОДТВЕРЖДЕННЫЕТРАНЗАКЦИИ", false) == true )
		{
			СуммаОплатыПС					= ROUND( _ККТСУММАБЕЗНАЛ, 2)*100;
			DriverPayCard.SParam ("Amount", СуммаОплатыПС);
			//подтверждаем транзакцию
			ОтветПС = DriverPayCard.NFun(6001);
			IF ( ОтветПС <> 0 )
			{
				СООБЩЕНИЕ("ВНИМАНИЕ! ВОЗМОЖНЫ РАСХОЖДЕНИЯ ДАННЫХ ИБ И ДАННЫХ В ККМ. ОШИБКА ( " + ОтветПС + ")" + CHR(13) + "НЕ УДАЛОСЬ ЗАФИКСИРОВАТЬ БАНКОВСКУЮ ТРАНЗАКЦИЮ", ФР.КОДОБОРУДОВАНИЯ());
			}
		}
	}
	ELSE
	{
		СООБЩЕНИЕ ( "Производится отмена транзакции через платежную систему", ФР.КОДОБОРУДОВАНИЯ() );
		IF ( ПЕРЕМЕННАЯ("_ИСПОЛЬЗОВАТЬНЕПОДТВЕРЖДЕННЫЕТРАНЗАКЦИИ", false) == true )
		{
			СуммаОплатыПС					= ROUND( _ККТСУММАБЕЗНАЛ, 2)*100;
			DriverPayCard.SParam ("Amount", СуммаОплатыПС);
			//аварийная отмена транзакции
			ОтветПС = DriverPayCard.NFun(6004);		
			IF ( ОтветПС <> 0 )
			{
				СООБЩЕНИЕ("ВНИМАНИЕ! ВОЗМОЖНЫ РАСХОЖДЕНИЯ ДАННЫХ ИБ И ДАННЫХ В ККМ. ОШИБКА ( " + ОтветПС + ")" + CHR(13) + "НЕ УДАЛОСЬ ПРОИЗВЕСТИ АВАРИЙНУЮ ОТМЕНУ БАНКОВСКОЙ ТРАНЗАКЦИИ", ФР.КОДОБОРУДОВАНИЯ());
			}
		}
		ELSE
		{
			СуммаОплатыПС					= ROUND( _ККТСУММАБЕЗНАЛ,2)*100;
			DriverPayCard.SParam ("Amount", СуммаОплатыПС);
			//отмена транзакции
			ОтветПС = DriverPayCard.NFun(4003);		
			IF ( ОтветПС <> 0 )
			{
				СООБЩЕНИЕ("ВНИМАНИЕ! ВОЗМОЖНЫ РАСХОЖДЕНИЯ ДАННЫХ ИБ И ДАННЫХ В ККМ. ОШИБКА ( " + ОтветПС + ")" + CHR(13) + "НЕ УДАЛОСЬ ОТМЕНИТЬ БАНКОВСКУЮ ТРАНЗАКЦИЮ", ФР.КОДОБОРУДОВАНИЯ());
			}			
		}
	}
	DriverPayCard.Clear();
	DriverPayCard = false;
	_ККТСУММАБЕЗНАЛ					= 0;
	IF ( SPLITPSYSTEM <> true AND SPLITPSYSTEM <> "true" )
		ВСЕГОБЕЗНАЛ 				= 0;
}

RETURN true;
