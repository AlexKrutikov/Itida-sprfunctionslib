НачалоСимволовGTIN = 1; //определеяем начало символов расположения GTIN в штрихкоде маркировки
//если встретили первыми двумя символами идентификатор 01, то смещаем начало чтения GTIN
IF ( LEFT( ШтрихкодМаркировки, 2 ) == "01" ) 
	НачалоСимволовGTIN = НачалоСимволовGTIN + 2;

//ОПРЕДЕЛИМ GTIN
gtin = SUBSTR( ШтрихкодМаркировки, НачалоСимволовGTIN, 14);

НачалоСимволовSERIAL = LEN(gtin) + НачалоСимволовGTIN; // вычисляем начало символов расположения SERIAL в штрихкоде маркировки
IF ( SUBSTR( ШтрихкодМаркировки, НачалоСимволовSERIAL, 2) == "21" ) //если сразу после GTIN встретили идентификатор 21, то смещаем начало чтения серийного номера на 2 символа
	НачалоСимволовSERIAL = НачалоСимволовSERIAL + 2;
	
КоличествоСимволовSERIAL = 13; //наиболее распространенный вариант
//далее по типу маркировки определим сколько символов необходимо брать для SERIAL
IF ( ТипМаркировки == "0005" )						
	КоличествоСимволовSERIAL = 7; //табак
ELSE IF ( ТипМаркировки == "1520" )						
	КоличествоСимволовSERIAL = 13; //обувь
ELSE IF ( ТипМаркировки == "0003" )
	КоличествоСимволовSERIAL = 13; //лекарства
ELSE IF ( ТипМаркировки == "0002" )
	КоличествоСимволовSERIAL = 20; //шубы
ELSE IF ( ТипМаркировки == "9999" )
	КоличествоСимволовSERIAL = 20; //прочая
ELSE IF ( ТипМаркировки == "9996" )
	КоличествоСимволовSERIAL = 20; //фото
ELSE IF ( ТипМаркировки == "9995" )
	КоличествоСимволовSERIAL = 13; //парфюм
ELSE IF ( ТипМаркировки == "9997" )
	КоличествоСимволовSERIAL = 13; //шины
ELSE IF ( ТипМаркировки == "9998" )
	КоличествоСимволовSERIAL = 13; //легпром
ELSE IF ( ТипМаркировки == "9994" )	
	КоличествоСимволовSERIAL = 7; //АТП

//ОПРЕДЕЛИМ SERIAL
serial = SUBSTR( ШтрихкодМаркировки, НачалоСимволовSERIAL, КоличествоСимволовSERIAL);

ДлиннаКода = НачалоСимволовSERIAL + КоличествоСимволовSERIAL - 1;

//для табака будем возвращать нулевую длинну, чтобы шк марки не изменился при передаче
IF ( ТипМаркировки == "0005" )
	ДлиннаКода = 0;
	
RETURN ДлиннаКода;
