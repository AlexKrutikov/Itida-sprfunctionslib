IF ( ПУСТО( КОДОБОРУДОВАНИЯ ) )
{
	СООБЩЕНИЕ( "Ошибка работы с ФР (" + МестоВызова + ")." + CHR( 13 ) +"Не определен код оборудования", "Ошибка работы с ККМ" );
	RETURN false;
}

IF ( ПУСТО( _МАССИВКЛЮЧЕЙФР[ VAL( ФР.КОДОБОРУДОВАНИЯ() ) ]  ) )
	RETURN true;
	
ОтсоединятьсяОтУстройства		= ЗАПРОС( "SELECT f_disconnect FROM sprequipment WHERE code = '" + КОДОБОРУДОВАНИЯ + "'" ) == 1;

IF ( ОтсоединятьсяОтУстройства )
{
	Команда = ДАННЫЕ_JSON("command", "CloseSession");

	ТекстЗапроса = "{ ""sessionKey"": """ + _МАССИВКЛЮЧЕЙФР[ VAL( ФР.КОДОБОРУДОВАНИЯ() ) ]  + """, " + Команда + " }";

	ОТВЕТ = "";
	
	IF ( !ФР.МЕРКУРИЙФР_HTTPPOST(ФР.МЕРКУРИЙФР_АДРЕССЕРВЕРА(), "/api.json", ТекстЗапроса, "", @ОТВЕТ) )
	{
		_МАССИВКЛЮЧЕЙФР[ VAL( ФР.КОДОБОРУДОВАНИЯ() ) ]  = "";
		RETURN false;
	}
	_МАССИВКЛЮЧЕЙФР[ VAL( ФР.КОДОБОРУДОВАНИЯ() ) ]  = "";	
}

RETURN true;
