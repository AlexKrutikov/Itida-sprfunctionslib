// Если карта не введена, то никаких начислений, бонусов и скидок нет
IF ( КОЛИЧЕСТВОКАРТ <= 0 ) RETURN true;

НПП = 0;
WHILE ( НПП < КОЛИЧЕСТВОКАРТ )
{
	НОМЕРКАРТЫТЕКУЩЕЙ = КАРТЫ[ НПП ];
	
	ТИПБОНУСА			= ЗАПРОС( "SELECT bonusalias FROM sprbonus WHERE code IN ( SELECT bonus FROM sprmcard WHERE cardn = '" + НОМЕРКАРТЫТЕКУЩЕЙ + "' )" );
	IF ( !ПУСТО( ТИПБОНУСА ) )
	{
		ОПЛАЧЕНОБОНУСОМ 	= ЗАПРОС( "SELECT SUM( summa ) FROM specmcard_bonus WHERE cardn ='" + НОМЕРКАРТЫТЕКУЩЕЙ + "' AND priz= '-' AND chequeic= " + ИДОбъекта );
		НАЧИСЛЕНОБОНУСОВ	= ЗАПРОС( "SELECT SUM( summa ) FROM specmcard_bonus WHERE cardn ='" + НОМЕРКАРТЫТЕКУЩЕЙ + "' AND priz= '+' AND chequeic= " + ИДОбъекта );
		ОСТАТОКБОНУСОВ		= ЗАПРОС( "SELECT dbo.fn_calccard_bonus( '" + НОМЕРКАРТЫТЕКУЩЕЙ + "', '" + ТИПБОНУСА + "', DEFAULT );" );

		IF ( !ПУСТО( ОПЛАЧЕНОБОНУСОМ ) OR !ПУСТО( НАЧИСЛЕНОБОНУСОВ ) OR !ПУСТО( ОСТАТОКБОНУСОВ ) )
		{	
			IF ( !ФР.МЕРКУРИЙФР_ПечатьСтроки("---------------------------------------------") )	RETURN false;
			IF ( !ФР.МЕРКУРИЙФР_ПечатьСтроки("Карта:   " + НОМЕРКАРТЫТЕКУЩЕЙ ) ) RETURN false;
			
			IF ( !ПУСТО( ОПЛАЧЕНОБОНУСОМ ) ) 
			{
				IF ( !ФР.МЕРКУРИЙФР_ПечатьСтроки("Списано бонусов:   " + СТРОКА( ОПЛАЧЕНОБОНУСОМ, 10, 2 ) ) ) RETURN false;
			}
			IF ( !ПУСТО( НАЧИСЛЕНОБОНУСОВ ) )
			{
				IF ( !ФР.МЕРКУРИЙФР_ПечатьСтроки("Начислено бонусов: " + СТРОКА( НАЧИСЛЕНОБОНУСОВ, 10, 2 ) ) ) RETURN false;
			}
			IF ( !ФР.МЕРКУРИЙФР_ПечатьСтроки("Остаток бонусов:   " + СТРОКА( ОСТАТОКБОНУСОВ, 10, 2 ) ) ) RETURN false;
			IF ( !ФР.МЕРКУРИЙФР_ПечатьСтроки("---------------------------------------------") )	RETURN false;
		}
	}
	
	НПП++;
	
}
RETURN true;
