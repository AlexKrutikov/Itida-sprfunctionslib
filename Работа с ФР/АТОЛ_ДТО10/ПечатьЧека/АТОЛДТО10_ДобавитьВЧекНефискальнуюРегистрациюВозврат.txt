//СуммаПозиции = ROUND (КомандыЧека.quantity*КомандыЧека.price - КомандыЧека.discountvalue, 2);
//СуммаПозиции = ROUND( КомандыЧека.summa - КомандыЧека.discountvalue, 2);
СуммаПозиции 		= ROUND( КомандыЧека.summa, 2);
СуммаСкидкиПозиции	= КомандыЧека.discountvalue;
ЦенаУчетная 		= КомандыЧека._price_u;
ЦенаПродажиПозиции 	= КомандыЧека.price;
КоличествоТовара	= КомандыЧека.quantity;
ВерсияФФД			= КомандыЧека.ffd_version;
РезультатПроверкиКМ = КомандыЧека.kmcheckresult;

IF ( ТИП( "_ФРНЕОТОБРАЖАТЬНАДБАВКИПРИНУЛЕВЫХЦЕНАХУЧЕТА" ) == "U" )
	_ФРНЕОТОБРАЖАТЬНАДБАВКИПРИНУЛЕВЫХЦЕНАХУЧЕТА = true;
	
IF ( _ФРНЕОТОБРАЖАТЬНАДБАВКИПРИНУЛЕВЫХЦЕНАХУЧЕТА AND ЦенаУчетная == 0 )
	СуммаСкидкиПозиции = 0;
ELSE IF ( !_ФРНЕОТОБРАЖАТЬНАДБАВКИПРИНУЛЕВЫХЦЕНАХУЧЕТА AND ЦенаУчетная == 0 )
	ЦенаПродажиПозиции = ЦенаУчетная;
	
//константа. отвечающая за необходимость скрывать все наценки
IF (TYPE ("_ФРСКРЫВАТЬВСЕНАЦЕНКИ") == "U")
	_ФРСКРЫВАТЬВСЕНАЦЕНКИ = true;
		
IF (_ФРСКРЫВАТЬВСЕНАЦЕНКИ == true)
	СуммаСкидкиПозиции = 0;
	
/*
//для ККТ на 5й платформе цена позиции должна указываться уже со скидками
ЭтоПлатформа5 = VAL( ЗАПРОС("SELECT value FROM param_ex WHERE param = 'ATOLKKTPLATFORM5" + ALLTRIM(КОДОБОРУДОВАНИЯ) + "'") ) == 1;
IF (ЭтоПлатформа5)
{*/
	//09.03.2021 - изменение алгоритма пробития скидок на единый для всех платформ ККТ.
	ЦенаПродажиПозиции = ROUND(СуммаПозиции/ЕСЛИ(КоличествоТовара==0,1,КоличествоТовара), 2);
//}


IF (TYPE ("_ВЫВОДИТЬПРИЗНАКМАРКИРОВКИВБУМАЖНОМЧЕКЕ") == "U")
	_ВЫВОДИТЬПРИЗНАКМАРКИРОВКИВБУМАЖНОМЧЕКЕ = false;  //признак необходимости выводить букву [М] для товарной позиции в чеке средствами профиля. По умолчанию отключено (значение false),
													//т.к. ожидается что буква [М] будет выводиться средствами прошивки
			
	
ФР.АТОЛДТО10_ДобавитьСтрокуЧека(ПозицииЧека, LEFT( ФР.XMLTRANS( КомандыЧека.name ), 128), false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
ФР.АТОЛДТО10_ДобавитьСтрокуЧека(ПозицииЧека, ALLTRIM( STR( ЦенаПродажиПозиции, 16, 2 ) + " * " + КоличествоТовара + " = " + STR( СуммаПозиции, 16, 2 ) ), false, "text", "right", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
//ФР.АТОЛДТО10_ДобавитьСтрокуЧека(ПозицииЧека, "НДС не облагается", false, "text", "left", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
//ФР.АТОЛДТО10_ДобавитьСтрокуЧека(ПозицииЧека, "ТОВАР", false, "text", "left", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
