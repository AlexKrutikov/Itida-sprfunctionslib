// Если карта не введена, то никаких начислений, бонусов и скидок нет
IF ( КОЛИЧЕСТВОКАРТ <= 0 ) RETURN ПозицииЧека;

НПП = 0;
WHILE ( НПП < КОЛИЧЕСТВОКАРТ )
{
	НОМЕРКАРТЫТЕКУЩЕЙ = КАРТЫ[ НПП ];
	
	ТИПБОНУСА			= ЗАПРОС( "SELECT bonusalias FROM sprbonus WHERE code IN ( SELECT bonus FROM sprmcard WHERE cardn = '" + НОМЕРКАРТЫТЕКУЩЕЙ + "' )" );
	IF ( !ПУСТО( ТИПБОНУСА ) )
	{
		ОПЛАЧЕНОБОНУСОМ 	= ЗАПРОС( "SELECT SUM( summa ) FROM specmcard_bonus WHERE cardn ='" + НОМЕРКАРТЫТЕКУЩЕЙ + "' AND priz= '-' AND chequeic= " + ИДОбъекта );
		НАЧИСЛЕНОБОНУСОВ	= ЗАПРОС( "SELECT SUM( summa ) FROM specmcard_bonus WHERE cardn ='" + НОМЕРКАРТЫТЕКУЩЕЙ + "' AND priz= '+' AND chequeic= " + ИДОбъекта );
		ОСТАТОКБОНУСОВ		= ЗАПРОС( "SELECT dbo.fn_calccard_bonus( '" + НОМЕРКАРТЫТЕКУЩЕЙ + "', '" + ТИПБОНУСА + "', DEFAULT );" );
		
		IF ( !ПУСТО( ОПЛАЧЕНОБОНУСОМ ) OR !ПУСТО( НАЧИСЛЕНОБОНУСОВ ) OR !ПУСТО( ОСТАТОКБОНУСОВ ) )
		{
			ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "---------------------------------------------", false, "text", "left", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
			ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Карта:   " + НОМЕРКАРТЫТЕКУЩЕЙ, false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
			
			IF ( !ПУСТО( ОПЛАЧЕНОБОНУСОМ ) ) ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Списано бонусов:   " + СТРОКА( ОПЛАЧЕНОБОНУСОМ, 10, 2 ), false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
			IF ( !ПУСТО( НАЧИСЛЕНОБОНУСОВ ) ) ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Начислено бонусов: " + СТРОКА( НАЧИСЛЕНОБОНУСОВ, 10, 2 ), false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
			ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Остаток бонусов:   " + СТРОКА( ОСТАТОКБОНУСОВ, 10, 2 ), false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
			ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "---------------------------------------------", false, "text", "left", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		}
	}
	
	НПП++;
}

RETURN ПозицииЧека;
