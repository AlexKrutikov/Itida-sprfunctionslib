// Если карта не введена, то никаких начислений, бонусов и скидок нет
IF ( КОЛИЧЕСТВОКАРТ <= 0 ) RETURN ПозицииЧека;

НПП = 0;
WHILE ( НПП < КОЛИЧЕСТВОКАРТ )
{
	НОМЕРКАРТЫТЕКУЩЕЙ = КАРТЫ[ НПП ];
	
	ТИПБОНУСА			= ЗАПРОС( "SELECT bonusalias FROM sprbonus WHERE code IN ( SELECT bonus FROM sprmcard WHERE cardn = '" + НОМЕРКАРТЫТЕКУЩЕЙ + "' )" );
	IF ( !ПУСТО( ТИПБОНУСА ) )
	{
		ОПЛАЧЕНОБОНУСОМ 	= СТРОКА( ЗАПРОС( "SELECT SUM( summa ) FROM specmcard_bonus WHERE cardn ='" + НОМЕРКАРТЫТЕКУЩЕЙ + "' AND priz= '-' AND chequeic= " + ИДОбъекта ), 10, 2 );
		НАЧИСЛЕНОБОНУСОВ	= СТРОКА( ЗАПРОС( "SELECT SUM( summa ) FROM specmcard_bonus WHERE cardn ='" + НОМЕРКАРТЫТЕКУЩЕЙ + "' AND priz= '+' AND chequeic= " + ИДОбъекта ), 10, 2 );
		ОСТАТОКБОНУСОВ		= СТРОКА( ЗАПРОС( "SELECT dbo.fn_calccard_bonus( '" + НОМЕРКАРТЫТЕКУЩЕЙ + "', '" + ТИПБОНУСА + "', DEFAULT );" ), 10, 2 );

		ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "---------------------------------------------", false, "text", "left", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Карта:   " + НОМЕРКАРТЫТЕКУЩЕЙ, false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Списано бонусов:   " + ОПЛАЧЕНОБОНУСОМ, false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Начислено бонусов: " + НАЧИСЛЕНОБОНУСОВ, false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "Остаток бонусов:   " + ОСТАТОКБОНУСОВ, false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, "---------------------------------------------", false, "text", "left", "none", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
	}
	
	НПП++;
}

RETURN ПозицииЧека;
