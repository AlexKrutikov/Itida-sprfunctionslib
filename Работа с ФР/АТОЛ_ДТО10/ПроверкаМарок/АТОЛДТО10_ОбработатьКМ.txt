//пропускаем ФР, у которых не установлен флаг проверки КМ
//возвращаем true чтобы прошла проверка по остальным ФР, если они есть

ПроверятьКМНаФР = ЗАПРОС("SELECT f_checkkm FROM sprequipment WHERE code = '" + КОДОБОРУДОВАНИЯ + "'");
IF (!ПроверятьКМНаФР)
	RETURN true;

//короткие коды маркировки не проверяем, а сразу возвращаем ошибку проверки
IF ( ПУСТО(ШТРИХКОДМАРКИРОВКИ) OR LEN(ШТРИХКОДМАРКИРОВКИ) <= 13 )
	RETURN false;
	
//проверять КМ будем только для продажи и возврата	
ТипОперацииЧека = ПЕРЕМЕННАЯ("ОПЕРАЦИЯ", "ПРОДАЖА");
IF ( !ВСПИСКЕ(ТипОперацииЧека, 1, 2, "ПРОДАЖА", "ВОЗВРАТ") ) 
	RETURN true;
	
РезультатПроверкиСведенийОКМ  = "";

IF ( !ФР.АТОЛДТО10_ПроверитьКМ( КОДОБОРУДОВАНИЯ, false, ШТРИХКОДМАРКИРОВКИ, "", @РезультатПроверкиСведенийОКМ ) )
	RETURN false;

ФР.ККТ_ЗаписатьРезультатПроверкиКМВКонтекст(ШТРИХКОДМАРКИРОВКИ, РезультатПроверкиСведенийОКМ);
	
RETURN true;
