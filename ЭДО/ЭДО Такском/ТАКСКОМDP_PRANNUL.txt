IF ( ДЛИНА( ФирмаИНН ) == 12 )	// ИП{	Фамилия	= ЛЕВСИМВ( ФирмаНаименование, AT( ФирмаНаименование, " " ) - 1 );	Имя		= ПОДСТРОКА( ФирмаНаименование, AT( ФирмаНаименование, " " ) + 1 );	Отчество= ПОДСТРОКА( ФирмаНаименование, AT( ФирмаНаименование, " ", 2 ) + 1 );	НаимОрг	= "<ИП ИННФЛ=""" + ФирмаИНН + """><ФИО Фамилия= """ + Фамилия + """ Имя= """ + Имя + """ " + ЕСЛИ( !ПУСТО( Отчество ), "Отчество=""" + Отчество + """ ", "" ) + "/></ИП>";}ELSE	НаимОрг		= "<ЮЛ НаимОрг=""" + ФирмаНаименование + """ ИННЮЛ=""" + ФирмаИНН + """ КПП=""" + ФирмаКПП + """ />";КлиентИНН		= ЗАПРОС( "SELECT inn, kpp, name,								  LEFT( client.fio, CHARINDEX( ' ', client.fio ) ) AS clientfirstname, 								  CASE WHEN CHARINDEX( ' ', client.fio, CHARINDEX( ' ', client.fio ) + 1 ) > 0 THEN SUBSTRING( client.fio, CHARINDEX( ' ', client.fio ) + 1, CHARINDEX( ' ', client.fio, CHARINDEX( ' ', client.fio ) + 1 ) - CHARINDEX( ' ', client.fio ) - 1 ) ELSE '' END AS clientmidname, 								  CASE WHEN CHARINDEX( ' ', client.fio, CHARINDEX( ' ', client.fio ) + 1 ) > 0 THEN SUBSTRING( client.fio, CHARINDEX( ' ', client.fio, CHARINDEX( ' ', client.fio ) + 1 ) + 1,  100 ) ELSE '' END AS clientlastname						   FROM sprclient client 						   WHERE client.notavail = 0 AND client.ediid = '" + ЭДОИДКлиента + "' OR client.ediid2 = '" + ЭДОИДКлиента + "'", "inn" );КлиентКПП		= ЗАПРОС( "", "kpp" );КлиентНазвание	= Сервис.XMLЗаменитьСимволы( ЗАПРОС( "", "name" ) );Фамилия			= Сервис.XMLЗаменитьСимволы( ЗАПРОС( "", "clientfirstname" ) );Имя				= Сервис.XMLЗаменитьСимволы( ЗАПРОС( "", "clientmidname" ) );Отчество		= Сервис.XMLЗаменитьСимволы( ЗАПРОС( "", "clientlastname" ) );IF ( ДЛИНА( КлиентИНН ) == 12 )	// ИП	НаимКлиент		= "<ИП ИННФЛ=""" + КлиентИНН + """><ФИО Фамилия= """ + Фамилия + """ Имя= """ + Имя + """ " + ЕСЛИ( !ПУСТО( Отчество ), "Отчество=""" + Отчество + """ ", "" ) + "/></ИП>";ELSE	НаимКлиент		= "<ЮЛ НаимОрг=""" + КлиентНазвание + """ ИННЮЛ=""" + КлиентИНН + """ КПП=""" + КлиентКПП + """ />";RETURN "<?xml version=""1.0"" encoding=""windows-1251""?><Файл ВерсПрог=""Айтида"" ВерсФорм=""1.02"" ИдФайл=""" + ИмяАнФайла + """><Документ КНД=""1115113"">	<УчастЭДО ИдУчастЭДО=""" + ФирмаЭДОИД + """>		" + НаимОрг + "	</УчастЭДО>	<СвПредАн>		<СведАнФайл ИмяАнФайла=""" + ИмяПодписанногоФайла + """>			<ЭЦПАнФайл>" + ПодписьФайла + "</ЭЦПАнФайл>		</СведПолФайл>		<ТекстПредАн>" + Причина + "</ТекстПредАн>	</СвПредАн>	<НапрПредАн ИдУчастЭДО=""" + ЭДОИДКлиента + """>		" + НаимКлиент + "	</НапрПредАн>	<Подписант Должность=""" + ПодписантДолжность + """>		<ФИО Имя=""" + ПодписантИмя + """ Фамилия=""" + ПодписантФамилия + """ " + ЕСЛИ( !ПУСТО( ПодписантОтчество ), "Отчество=""" + ПодписантОтчество + """ ", "" ) + "/>	</Подписант></Документ></Файл>";
