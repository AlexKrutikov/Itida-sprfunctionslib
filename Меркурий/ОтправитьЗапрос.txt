IF ( ПУСТО( ПОДСИСТЕМА ) )	ПОДСИСТЕМА		= "";ПОДСИСТЕМА			= UPPER( ALLTRIM( ПОДСИСТЕМА ) );IF ( ТИП( "_МЕРКУРИЙИМЯФАЙЛАЖУРНАЛА" ) != "C" )	_МЕРКУРИЙИМЯФАЙЛАЖУРНАЛА	= "d:\mercury_http.log";ИмяФайлаЖурнала 	= _МЕРКУРИЙИМЯФАЙЛАЖУРНАЛА;// Если в параметрах указаны свои значения логина и пароля, то их и используемIF ( ТИП( "МЕРКУРИЙЛОГИН" ) == "C" && ТИП( "МЕРКУРИЙПАРОЛЬ" ) == "C" ){	ИмяВхода 			= МЕРКУРИЙЛОГИН;	Пароль		 		= МЕРКУРИЙПАРОЛЬ;	ТестовыйКонтур		= МЕРКУРИЙТЕСТОВЫЙКОНТУР; }ELSE{	ИмяВхода 			= ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'MERC_APILOGIN" + _КОДМЕРКУРИЯ + "'" ); //"ooo911-171102";	Пароль		 		= ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'MERC_APIPASSWORD" + _КОДМЕРКУРИЯ + "'" ); //"8MsT4ef7";	ТестовыйКонтур		= VAL( ЗАПРОС( "SELECT value FROM param_ex WHERE param = 'MERC_APITEST" + _КОДМЕРКУРИЯ + "'" ) ) != 0; }КодированыйПароль	= ПЕРЕКОДИРОВАТЬ( ALLTRIM( ИмяВхода ) + ":" + ALLTRIM( Пароль ), "ANSI", "BASE64" ); АдресСервера 		= ЕСЛИ( ТестовыйКонтур, "https://api2.vetrf.ru:8002", "https://api.vetrf.ru" );//Сервис обработки заявок (ApplicationManagementsService)/*АдресСервисаЗаявок 	= "/platform/services/2.0/ApplicationManagementService";//Цербер (EnterpriseService) - сервис получения реестра хозяйствующих субъектов и предприятий АдресСервисаЦербер 	= "/platform/services/2.0/EnterpriseService";//Икар (IkarService) - сервис получения адресной справочной информации  АдресСервисаИкар 	= "/platform/services/2.0/IkarService";//DictionaryService - Сервис получения справочной информации   АдресСервисаСправочники = "/platform/services/2.0/DictionaryService";//ProductService - Сервис получения реестра категорий продукции    АдресСервисаПродукция = "/platform/services/2.0/ProductService";*///Сервис обработки заявок (ApplicationManagementsService)АдресСервисаЗаявок 		= "/platform/services/2.1/ApplicationManagementService";//Цербер (EnterpriseService) - сервис получения реестра хозяйствующих субъектов и предприятий АдресСервисаЦербер 		= "/platform/services/2.1/EnterpriseService";//Икар (IkarService) - сервис получения адресной справочной информации  АдресСервисаИкар 		= "/platform/services/2.1/IkarService";АдресСервисаИкар0 		= "/platform/ikar/services/IkarService";//DictionaryService - Сервис получения справочной информации   АдресСервисаСправочники = "/platform/services/2.1/DictionaryService";//ProductService - Сервис получения реестра категорий продукции    АдресСервисаПродукция 	= "/platform/services/2.1/ProductService";АдресСервисаПродукция0	= "/platform/ikar/services/IkarService";ТекстЗапроса		= ПЕРЕКОДИРОВАТЬ( ТекстЗапроса, "ANSI", "UTF-8" );Заголовки[ 0 ]		= "Content-Type: text/xml; charset=utf-8";заголовки[ 1 ] 		= "Content-Length: " + STR( ДЛИНА( ТекстЗапроса ) );Заголовки[ 2 ] 		= "Authorization: Basic " + КодированыйПароль;АдресПодсистемы		= ЕСЛИ( ПУСТО( ПОДСИСТЕМА ) OR ПОДСИСТЕМА == "ЗАЯВКИ", АдресСервисаЗаявок, ЕСЛИ( ПОДСИСТЕМА == "ПРЕДПРИЯТИЯ", АдресСервисаЦербер, 					  ЕСЛИ( ПОДСИСТЕМА == "АДРЕСА", АдресСервисаИкар, ЕСЛИ( ПОДСИСТЕМА == "АДРЕСА0", АдресСервисаИкар0, ЕСЛИ( ПОДСИСТЕМА == "СПРАВОЧНИКИ", АдресСервисаСправочники, 					  ЕСЛИ( ПОДСИСТЕМА == "ПРОДУКЦИЯ0", АдресСервисаПродукция0, АдресСервисаПродукция ) ) ) ) ) );Соединение 			= HTTPCONNECT( АдресСервера, "", true, ИмяФайлаЖурнала );Ответ				= HTTPPOST( Соединение, АдресПодсистемы, ТекстЗапроса, "Заголовки" );HTTPCLOSE( Соединение );IF ( AT( Ответ, "Error 401" ) > 0 ){	СИСТЕМНОЕСООБЩЕНИЕ( "#2#ErrorОшибка авторизации. Проверьте логин и пароль." );	Ответ				= "";	_ПРЕРВАТЬВЫПОЛНЕНИЕ = true;}IF ( AT( Ответ, "soapenv:Fault" ) > 0 ){	ДОБАВИТЬКОНТЕКСТ( "SET FMTONLY ON SELECT '' AS faultstring, '' AS base_message SET FMTONLY OFF", "Ошибка", 1 );	ЗАГРУЗИТЬ( "Ошибка", "XMLSTRING", Ответ, "soapenv_Envelope", "", "", "" );	СИСТЕМНОЕСООБЩЕНИЕ( "#2#Error " + Ошибка.faultstring + " " + Ошибка.base_message );	Ответ				= "";	_ПРЕРВАТЬВЫПОЛНЕНИЕ = true;}Соединение 			= false;RETURN Ответ;
