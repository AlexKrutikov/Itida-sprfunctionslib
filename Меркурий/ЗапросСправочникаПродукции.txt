ДОБАВИТЬКОНТЕКСТ( "SET FMTONLY ON SELECT CONVERT( int, 0 ) AS count, CONVERT( int, 0 ) AS total, CONVERT( int, 0 ) AS offset SET FMTONLY OFF", "Данные" );ДОБАВИТЬКОНТЕКСТ( "SET FMTONLY ON SELECT '' AS bs_guid, '' AS pro_name SET FMTONLY OFF", "Продукция" );Количество				= 0;ТекущееСмещение			= 0;ОбщееКоличество			= 0;СИСТЕМНОЕСООБЩЕНИЕ( "Запрос справочника продукции. Тип " + ТИППРОДУКЦИИ );WHILE ( Количество == 0 OR ТекущееСмещение < ОбщееКоличество ){	Текст = "	<soapenv:Envelope xmlns:soapenv=""http://schemas.xmlsoap.org/soap/envelope/""					  xmlns:ws=""http://api.vetrf.ru/schema/cdm/argus/production/ws-definitions""					  xmlns:base=""http://api.vetrf.ru/schema/cdm/base"" 					  xmlns:prod=""http://api.vetrf.ru/schema/cdm/argus/production"">	  <soapenv:Header/>	  <soapenv:Body>		<ws:getProductByTypeListRequest>		  <base:listOptions>			<base:count>1000</base:count>			<base:offset>" + ТекущееСмещение + "</base:offset>		  </base:listOptions> 		  <prod:productType>" + ТИППРОДУКЦИИ + "</prod:productType>		</ws:getProductByTypeListRequest>	  </soapenv:Body>	</soapenv:Envelope>	";	ОтветСервера			= Меркурий.ОтправитьЗапрос( Текст, "ПРОДУКЦИЯ0" );	ЗАГРУЗИТЬ( "Данные", "XMLSTRING", ОтветСервера );	ЗАГРУЗИТЬ( "Продукция", "XMLSTRING", ОтветСервера, 'pro:product' );	ПЕРЕЙТИВНАЧАЛО( "Данные" );		Количество			= 1000;	ТекущееСмещение		= Данные.offset + Данные.count;	IF ( ОбщееКоличество == 0 )	{		ОбщееКоличество	= Данные.total;		IF ( ОбщееКоличество > 10 )			ИНДИКАТОР( "Загрузка справочника продукции измрения", ОбщееКоличество );	}	ELSE IF ( ОбщееКоличество > 10 )		ИНДИКАТОР( ТекущееСмещение, "Загружено " + STR( ТекущееСмещение ) + " из " + STR( ОбщееКоличество ) );			УДАЛИТЬ( "ALL", "Данные" );}ИНДИКАТОР( );УДАЛИТЬКОНТЕКСТ( "Данные" );// Запишем полученный результат в указанную таблицуПЕРЕЙТИВНАЧАЛО( "Продукция" );WHILE ( !КОНЕЦКОНТЕКСТА( "Продукция" ) ){	__SQL {		INSERT INTO [[ИМЯТАБЛИЦЫ]] ( producttype, product, name, type_ ) 			VALUES ( '[[STDF( ТИППРОДУКЦИИ )]]', '[[STDF( Продукция.bs_guid )]]', '[[STDF( Продукция.pro_name )]]', 'P' );	}	IF ( !ПРОПУСТИТЬСУБПРОДУКЦИЮ )		IF ( !Меркурий.ЗапросСправочникаСубПродукции( ТИППРОДУКЦИИ, Продукция.bs_guid, Продукция.pro_name, ИМЯТАБЛИЦЫ ) ) RETURN false;	ПРОПУСТИТЬ( 1, "Продукция" );}УДАЛИТЬКОНТЕКСТ( "Продукция" );RETURN true;
