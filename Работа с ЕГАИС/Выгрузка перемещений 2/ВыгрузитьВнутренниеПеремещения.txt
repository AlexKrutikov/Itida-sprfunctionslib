	
// Формируем список наклданых для отправки
ДОБАВИТЬКОНТЕКСТ( "SELECT ndok, date FROM spr019 WHERE egaisstatus >= 2 AND identity_column IN ( SELECT ic FROM " + ИМЯТАБЛИЦЫ + " )", "СписокДокументов" );
ТекстСообщения		= "";
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокДокументов" ) )
{
	ТекстСообщения	+= СписокДокументов.ndok + " от " + DTOC( СписокДокументов.date ) + CHR( 13 );
	ПРОПУСТИТЬ( 1, "СписокДокументов" );
}
УДАЛИТЬКОНТЕКСТ( "СписокДокументов" );
IF ( !ПУСТО( ТекстСообщения ) )
	IF ( СООБЩЕНИЕ( "Следующие документы уже были отправлены в ЕГАИС. Продолжить? " + CHR( 13 ) + ТекстСообщения, "Отправка документов", 4 ) != 6 ) RETURN false;

// Проходим по списку отмеченных документов и отправляем их в ЕГАИС
ДОБАВИТЬКОНТЕКСТ( "SELECT temp.ic, spr.egaisstatus, CONVERT( bit, CASE WHEN spr.egaisdirection = 2 THEN 1 ELSE 0 END ) AS f_egaisretail
				   FROM " + ИМЯТАБЛИЦЫ + " temp
				   INNER JOIN spr019 spr ON temp.ic = spr.identity_column
				   WHERE spr.egaisdirection IN ( 1, 2 )", "СписокДокументов" );
IF ( КОЛИЧЕСТВОСТРОК( "СписокДокументов" ) == 0 )
{
	СООБЩЕНИЕ( "Необходимо отметить хотя бы один документ, для отправки.", "Отправка документов" );
	RETURN false;
}
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокДокументов" ) )
{
	IF ( ЕСЛИ( СписокДокументов.f_egaisretail, !ЕГАИС.ОтправитьВНПИЗМАГАЗИНА_В2( СписокДокументов.ic ), !ЕГАИС.ОтправитьВНПВМАГАЗИН_В2( СписокДокументов.ic ) ) ) RETURN false;
	ПРОПУСТИТЬ( 1, "СписокДокументов" );
}
УДАЛИТЬКОНТЕКСТ( "СписокДокументов" );
RETURN true;
