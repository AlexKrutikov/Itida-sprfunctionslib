// Печать прочих отчетов

// Параметры - 
// ТипОтчета число целое, тип требуемого отчета
// 		Значения:	0 - гашение контрольной ленты	
//					3 - краткий фискальный отчет по диапазону дат
//					4 - краткий фискальный отчет по диапазону смен
//					5 - полный фискальный отчет по диапазону дат
//					6 - полный фискальный отчет по диапазону смен
//					7 - отчет о продажах по секциям
// 					8 - отчет о продажах по кассирам
// 					9 - отчет о продажах по товарам
// 					10 - отчет о продажах по часам
// 					11 - отчет по количеству
// 					22 - ЭКЛЗ итоги активизации
// 					23 - ЭКЛЗ итоги смены
// 					24 - ЭКЛЗ контрольная лента смены
// 					26 - ЭКЛЗ по датам краткий по отделам
// 					27 - ЭКЛЗ по датам полный по отделам
// 					28 - ЭКЛЗ по датам краткий по итогам смен
// 					29 - ЭКЛЗ по датам полный по итогам смен
// 					30 - ЭКЛЗ по сменам краткий по отделам
// 					31 - ЭКЛЗ по сменам полный по отделам
// 					32 - ЭКЛЗ по сменам краткий по итогам
// 					33 - ЭКЛЗ по сменам полный по итогам
//					41 - копия последнего чека
//					42 - отчет о состоянии расчетов
//					50 - сверка итогов
//					100 - печать копии чека по номеру ФД
// Параметр - FROperatorProfile число, профиль из карточки сотрудника

_ERROR = false;

//печать слипа
IF ( Переменная("ЭтоБанковскийСлип", false) )
{
	IF ( !ФР.ШТРИХ_ОткрытьФР( КОДОБОРУДОВАНИЯ, "Печать слипа" ) ) RETURN false;
		
	Результат = ФР.ККТ_НапечататьСлипНаФР("ШТРИХ", СлипЧек, ПЕРЕМЕННАЯ("КОЛИЧЕСТВОСЛИПОВ", 1) );
	
	//проверим результат
	Результат = ФР.ШТРИХ_ЗакрытьФРСПроверкойНаОшибки( "Печать слипа" );
	
	RETURN Результат;
}

IF ( ( ТипОтчета >= 7 AND ТипОтчета <= 9 ) OR ВСПИСКЕ( ТипОтчета, 41, 42, 50, 100 ) )
{
	IF ( !ФР.ШТРИХ_ОткрытьФР( КОДОБОРУДОВАНИЯ, "ZОтчет" ) ) RETURN false;
	// Входим в режим снятия отчетов
	driverKKM.Password							= FROperatorProfile; // Пароль
	
	// Снимаем отчет
	
	IF (ТипОтчета == 7)
	{
		_ERROR				= driverKKM.PrintDepartmentReport() <> 0;
	}
	ELSE IF (ТипОтчета == 8)
	{
		_ERROR				= driverKKM.PrintCashierReport() <> 0;
	}
	ELSE IF (ТипОтчета == 9)
	{
		_ERROR				= driverKKM.PrintWareReport() <> 0;
	}
	ELSE IF (ТипОтчета == 41)
	{
		_ERROR				= driverKKM.RepeatDocument() <> 0;
	}
	ELSE IF (ТипОтчета == 42)
	{
		_ERROR				= driverKKM.FNBuildCalculationStateReport() <> 0;
	}
	ELSE IF ( ТипОтчета == 50 )
	{
		IF ( !ПУСТО( ИМЯПЛАТЕЖНОЙСИСТЕМЫ ) )
		{
			IF ( UPPER(ИМЯПЛАТЕЖНОЙСИСТЕМЫ) == "ПСАТОЛ")
				ФР.ПСАТОЛ_СверкаИтогов( КОДОБОРУДОВАНИЯ, "ШТРИХ" );
			ELSE IF ( UPPER(ИМЯПЛАТЕЖНОЙСИСТЕМЫ) == "СБЕРБАНК")
				ФР.ПССБЕРБАНК_СверкаИтогов( КОДОБОРУДОВАНИЯ, "ШТРИХ" );
		}
		ELSE
			СООБЩЕНИЕ( """Сверка итогов"" не поддерживается профилем оборудования" );
			
	}
	ELSE IF (ТипОтчета == 100)
	{
		ПечатаемКопию = true;
		//проверим что номер чека передан, т.е. выбрали конкретный чек из списка или номер у выбранного чека не равен 0
		IF ( ПУСТО( VAL(НОМЕРЧЕКА) ) )
		{
			СООБЩЕНИЕ("Не выбран кассовый чек для печати копии", "Ошибка печати копии");
			ПечатаемКопию = false;
		}
		IF (ПечатаемКопию)
		{
			driverKKM.DocumentNumber = НОМЕРЧЕКА;
			driverKKM.ShowTagNumber = 0;
			_ERROR				= driverKKM.FNPrintDocument() <> 0;
		}
	}
	
	/*
	ФР.ШТРИХ_ОтрезатьЧек();
	*/
	//проверим результат
	Результат		= ФР.ШТРИХ_ЗакрытьФРСПроверкойНаОшибки( "Прочие отчеты" ); 
}
ELSE
	СООБЩЕНИЕ( "Отчет №" + ТипОтчета + ": Данный отчет не поддерживается профилем оборудования" );
	
RETURN Результат;
