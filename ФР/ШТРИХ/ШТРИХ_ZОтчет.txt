
// Печать Z-отчета
// Параметр - FROperatorProfile число, профиль из карточки сотрудника

ТекстВопроса = "Вы действительно хотите снять Z-отчет?";
IF ( СООБЩЕНИЕ( ТекстВопроса, ФР.ИМЯОБОРУДОВАНИЯ(), 4 ) == 7 ) //если нажали "Нет"
	RETURN false;
	
IF ( !ПУСТО( ИМЯПЛАТЕЖНОЙСИСТЕМЫ ) )
{
	ОшибкаЗакрытияБанковскогоДня = false;
	IF ( UPPER(ИМЯПЛАТЕЖНОЙСИСТЕМЫ) == "ПСАТОЛ")
	{
		IF ( !ФР.ПСАТОЛ_ЗакрытиеБанковскогоДня( ФР.КОДОБОРУДОВАНИЯ(), "ШТРИХ" ) )
			ОшибкаЗакрытияБанковскогоДня = true;
	}
	ELSE IF ( UPPER(ИМЯПЛАТЕЖНОЙСИСТЕМЫ) == "СБЕРБАНК")
	{
		IF ( !ФР.ПССБЕРБАНК_ЗакрытиеБанковскогоДня( ФР.КОДОБОРУДОВАНИЯ(), "ШТРИХ" ) )
			ОшибкаЗакрытияБанковскогоДня = true;
			
	}
	IF ( ОшибкаЗакрытияБанковскогоДня )
		СООБЩЕНИЕ("Банковская смена не закрылась. Попытайтесь закрыть её вручную, через Прочие отчеты - Сверка итогов. ", "Закрытие смены");
}

IF ( !ФР.ШТРИХ_ОткрытьФР( КОДОБОРУДОВАНИЯ, "ZОтчет" ) ) RETURN false;
	
//получим информацию о кассире
_ИМЯКАССИРА 	= ЗАПРОС( "SELECT name FROM sprempl WHERE code = '" + froperator + "'" );
_ИННКАССИРА 	= ЗАПРОС( "SELECT inn FROM sprempl WHERE code = '" + froperator + "'" );

// Вводим пароль оператора ККМ, входим в режим снятия Z-отчетов
driverKKM.Password						= FROperatorProfile;

// Снимаем отчет
_ERROR				= driverKKM.PrintReportWithCleaning( ) <> 0;

IF ( _ERROR )
{
	// Вывод ошибки
	MessageBox( "Ошибка " + driverKKM.ResultCode + " при снятии Z-отчета. Описание ошибки: " + driverKKM.ResultCodeDescription );
	_ОШИБКАВЫПОЛНЕНИЯ				= true;
	RETURN false;	
}	

// Частичная отрезка чека
/*
driverKKM.CutType = TRUE; //TRUE – неполная отрезка, FALSE – полная отрезка.
driverKKM.CutCheck();
*/
		
//Проверим возраст буфера чеков
ФР.ШТРИХ_ПроверкаВозрастаБуфера( );		

RETURN ФР.ШТРИХ_ЗакрытьФРСПроверкойНаОшибки( "ZОтчет" );
