// Свойства драйвера ФР.
PUBLIC _КЛЮЧ_СЕССИИ;

//Обработаем ситуацию когда карточка оборудования только создана и еще не записана
IF ( ПУСТО( КОДОБОРУДОВАНИЯ ) )
{
	СООБЩЕНИЕ( "Перед настройкой драйвера оборудования необходимо записать карточку торгового оборудования." );
	RETURN false;
}

ТЕКСТ_СПРАВКА = "Информация об адресе сервера INECRMAN по умолчанию берется из константы ""_ФРМЕРКУРИЙ_АДРЕССЕРВЕРА"" " + CHR(13) + CHR(10);
ТЕКСТ_СПРАВКА += "Так же для каждой карточки оборудования можно задавать свой персональный адрес сервера." + CHR(13) + CHR(10);
ТЕКСТ_СПРАВКА += "Для этого имя константы необходимо задать в виде ""_ФРМЕРКУРИЙ_АДРЕССЕРВЕРАКОДОБОРУДОВАНИЯ"", 
где КОДОБОРУДОВАНИЯ - это символьный код карточки торгового оборудования, для которого указывается свое персональное значение (Например: ""_ФРМЕРКУРИЙ_АДРЕССЕРВЕРА001"")." + CHR(13) + CHR(10);
ТЕКСТ_СПРАВКА += CHR(13) + CHR(10);
ТЕКСТ_СПРАВКА += CHR(13) + CHR(10);
ТЕКСТ_СПРАВКА += "Текущий адрес сервера INECRMAN: " + ФР.МЕРКУРИЙФР_АДРЕССЕРВЕРА();

СООБЩЕНИЕ(ТЕКСТ_СПРАВКА, "Информация");

_ОшибкаПолученияДанных = false;

IF ( ФР.МЕРКУРИЙФР_ОткрытьСессию(КОДОБОРУДОВАНИЯ, "Карточка оборудования") )
{
	ОТВЕТ = ФР.МЕРКУРИЙФР_ПолучениеИнформацииОККТ();
	
	IF ( !ПУСТО( ОТВЕТ ) )
	{
		ЗАГРУЗИТЬJSON( "ДанныеОтвета", ПЕРЕКОДИРОВАТЬ( ОТВЕТ, "UTF-8", "ANSI" ) );

		ИнфоМодель = ЗНАЧЕНИЕПОЛЯ( "ДанныеОтвета", "model" );
		ИнфоЗН = ЗНАЧЕНИЕПОЛЯ( "ДанныеОтвета", "kktNum" );
		ВерсияФФД = ЗНАЧЕНИЕПОЛЯ( "ДанныеОтвета", "ffdTotalVer" );
		ВерсияПО = ЗНАЧЕНИЕПОЛЯ( "ДанныеОтвета", "programVer" );
		
		СтрокаРезультата = ИнфоМодель + ", №" + ИнфоЗН + ", v." + ВерсияПО + ", ФФД " + ВерсияФФД;
		
		СООБЩЕНИЕ(СтрокаРезультата, "Инфо о ККТ");
		
		УДАЛИТЬКОНТЕКСТ( "ДанныеОтвета" );
	}
	ELSE
	{
		_ОшибкаПолученияДанных = true;			
	}
	ФР.МЕРКУРИЙФР_ЗакрытьСессию(КОДОБОРУДОВАНИЯ, "Карточка оборудования");
}

IF (_ОшибкаПолученияДанных)
	ВЫПОЛНИТЬ("iexplore.exe"," http://" + STRTRANC(ФР.МЕРКУРИЙФР_АДРЕССЕРВЕРА(),"http://",""), "", "open", 0 );
