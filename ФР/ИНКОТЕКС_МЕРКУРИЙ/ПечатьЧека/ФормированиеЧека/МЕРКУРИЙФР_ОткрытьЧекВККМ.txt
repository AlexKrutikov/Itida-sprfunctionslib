
Команда = ДАННЫЕ_JSON("command", "OpenCheck");
ТипЧека = ДАННЫЕ_JSON("checkType", VAL(КомандыЧека.checktype));
СНО		= ДАННЫЕ_JSON("taxSystem", ФР.МЕРКУРИЙФР_ПолучитьЗначениеСНО( ЗАПРОС( "SELECT taxtype FROM sprequipment WHERE code = '" + КОДОБОРУДОВАНИЯ + "'" ) ));
ПечататьЧек = ДАННЫЕ_JSON("printDoc", ЕСЛИ( ПЕРЕМЕННАЯ( "ЭЛЕКТРОННЫЙЧЕК", false ), false, true) );
/*
//следующие реквизиты не будем передавать при открытии, из-за необязательности
address (string, необяз.) – адрес расчёта.
location (string, необяз.) – место расчёта.
senderEmail (string, необяз.) – адрес электронной почты отправителя чека (ФФД: тег 1117).
additionalProps (string, необяз.) – дополнительный реквизит чека (ФФД: тег 1192). Строка не более 16 символов.
*/
_ИМЯКАССИРА		= "";
_ИННКАССИРА		= "";
IF ( !ФР.МЕРКУРИЙФР_ПолучитьДанныеКассира(froperator, @_ИМЯКАССИРА, @_ИННКАССИРА) )
	_ИМЯКАССИРА = "Кассир";
	
ДанныеКассира = " ""cashierInfo"": { " + ДАННЫЕ_JSON("cashierName",_ИМЯКАССИРА) + ", " + ДАННЫЕ_JSON("cashierINN",_ИННКАССИРА) + " }";

//покупатель
НаименованиеКлиента = "";
ИННКлиента 			= "";
IF ( !ПУСТО( КомандыЧека.clientcode ) )
{
	ДОБАВИТЬКОНТЕКСТ("SELECT priz, name, inn FROM sprclient WHERE code = '" + ALLTRIM(КомандыЧека.clientcode) + "'", "ДанныеКлиента", 1);
	ТипКлиента = VAL(ДанныеКлиента.priz);
	IF (ТипКлиента == 1 OR ТипКлиента == 3)
	{
		НаименованиеКлиента = ФР.XMLTRANS(ДанныеКлиента.name);
		ИННКлиента = ДанныеКлиента.inn;
	}
	УДАЛИТЬКОНТЕКСТ("ДанныеКлиента");
}
ДанныеКлиента = "";
IF ( !ПУСТО( НаименованиеКлиента ) )
{
	КлиентИмя = ДАННЫЕ_JSON("buyerName", НаименованиеКлиента);
	КлиентИНН = ДАННЫЕ_JSON("buyerINN", ИННКлиента);
	ДанныеКлиента = " ""buyerInfo"": { " + КлиентИмя + ", " + КлиентИНН + " }";
}

//формируем запрос открытия чека
ТекстЗапроса = "{ ""sessionKey"": """ + _МАССИВКЛЮЧЕЙФР[ VAL( ФР.КОДОБОРУДОВАНИЯ() ) ] + """, " + Команда + ", " + ТипЧека + ", " + СНО + ", " + ПечататьЧек + ", " + ДанныеКассира + 
	ЕСЛИ( !ПУСТО( ДанныеКлиента ), "," + ДанныеКлиента, "" ) + " }";

ОТВЕТ= "";
RETURN ФР.МЕРКУРИЙФР_HTTPPOST(ФР.МЕРКУРИЙФР_АДРЕССЕРВЕРА(), "/api.json", ТекстЗапроса, "", @ОТВЕТ);
