ТекстСообщения = "Ошибка обработки ответа от ККТ";

ЭТОРМК = false;			
IF (TYPE("_МРП") <> "U")
	ЭТОРМК = _МРП == "2";

IF ( ЭТОРМК )
{
	IF ( ТИП( "ДАННЫЕДЛЯОТПРАВКИ" ) == "C" )
		ДАННЫЕДЛЯОТПРАВКИ	= МАССИВИЗСТРОКИ( ДАННЫЕДЛЯОТПРАВКИ );
}
ELSE
	ДАННЫЕДЛЯОТПРАВКИ = ПЕРЕКОДИРОВАТЬ(ДАННЫЕДЛЯОТПРАВКИ, "ANSI", "UTF-8");
	
IF (ПУСТО(ЗАГОЛОВКИ))
{
	Заголовки[0] = "Content-Type: application/json; charset=utf-8";
	Заголовки[1] = "Content-Length: " + LEN(ДанныеДляОтправки);
}
ИмяФайлаЖурнала = ФР.ФАЙЛЖУРНАЛА();	
try
{
	ТекстОшибки			= "Сервер " + АДРЕССЕРВЕРАФР + CHR( 13 ) + "вернул сообщение об ошибке: " + CHR( 13 );
	Соединение 			= HTTPCONNECT( АДРЕССЕРВЕРАФР, "", false, ИмяФайлаЖурнала );
	Ответ				= ПЕРЕКОДИРОВАТЬ( HTTPPOST( Соединение, Ресурс, ДанныеДляОтправки, "Заголовки" ), "UTF-8", "ANSI" );
	
	IF ( !ФР.МЕРКУРИЙФР_ПРОВЕРКАНАОШИБКИ( @Ответ ) ) THROW ( ТекстОшибки + Ответ );
}
catch ( ТекстСообщения )
{
	HTTPCLOSE( Соединение );
	СООБЩЕНИЕ( ТекстСообщения );
	RETURN false;
}
HTTPCLOSE( Соединение );

Заголовки[0] = "";
Заголовки[1] = "";

RETURN true;
