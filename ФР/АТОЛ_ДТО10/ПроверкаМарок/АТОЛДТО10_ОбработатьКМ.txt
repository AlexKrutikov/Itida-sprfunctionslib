//пропускаем ФР, у которых не установлен флаг проверки КМ
//возвращаем true чтобы прошла проверка по остальным ФР, если они есть
ПроверятьКМНаФР = ЗАПРОС("SELECT f_checkkm FROM sprequipment WHERE code = '" + ФР.КОДОБОРУДОВАНИЯ() + "'");
IF (!ПроверятьКМНаФР)
	RETURN true;

//короткие коды маркировки не проверяем, а сразу возвращаем ошибку проверки
IF ( ПУСТО(ШТРИХКОДМАРКИРОВКИ) OR LEN(ШТРИХКОДМАРКИРОВКИ) <= 13 )
	RETURN false;
	
РезультатПроверкиСведенийОКМ  = "";
	
IF ( !ФР.АТОЛДТО10_ПроверитьКМ( ФР.КОДОБОРУДОВАНИЯ(), false, ШТРИХКОДМАРКИРОВКИ, "", @РезультатПроверкиСведенийОКМ ) )
	RETURN false;

//проверим существование контекста с результатами проверок и, если нет констекста, создадим его
IF ( !ВЫБРАТЬКОНТЕКСТ( "РезультатыОбработкиКМ" ) )
	IF ( !ДОБАВИТЬКОНТЕКСТ( "LOCAL: Штрихкод text, Результат text", "РезультатыОбработкиКМ" ) ) 
	{
		СООБЩЕНИЕ("Не удалось сохранить результаты проверки кода маркировки");
		RETURN false;
	}

//сохраним результаты проверки в контекст
ДОБАВИТЬСТРОКИ( 1, "РезультатыОбработкиКМ" );
ИЗМЕНИТЬПОЛЕ( "РезультатыОбработкиКМ", "Штрихкод", ALLTRIM(ШТРИХКОДМАРКИРОВКИ) );
ИЗМЕНИТЬПОЛЕ( "РезультатыОбработкиКМ", "Результат", РезультатПроверкиСведенийОКМ );
	
RETURN true;
