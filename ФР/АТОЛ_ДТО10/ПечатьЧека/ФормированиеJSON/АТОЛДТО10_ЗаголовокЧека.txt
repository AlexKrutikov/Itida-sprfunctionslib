ЗаголовокЧека = "";

//формируем начало текста чека
IF ( КомандыЧека.checktype == 0 OR КомандыЧека.checktype == "0" )
{
	ФискальныйЧек = false;
	ЗаголовокЧека = "{
		""type"": ""nonFiscal"",";
}
ELSE
{
	ФискальныйЧек = true;
	СистемаНО	= ФР.АТОЛДТО10_ПолучитьЗначениеСНО( ЗАПРОС( "SELECT taxtype FROM sprequipment WHERE code = '" + КОДОБОРУДОВАНИЯ + "'" ) );
	_ИННКАССИРА = ЗАПРОС("SELECT inn FROM sprempl WHERE code = " + _КАССИР );
	ВерсияФФД	= КомандыЧека.ffd_version;
	
	СтрокаПроверкиКМ_заголовок = "";
	IF (ALLTRIM(ВерсияФФД) == "1.2")
	{
		СтрокаПроверкиКМ_заголовок = "
		""validateMarkingCodes"": false,";
	}		
	
	ЗаголовокЧека = "{
		""type"": """ + КомандыЧека.checktype + """, " + СтрокаПроверкиКМ_заголовок + "
		" + ЕСЛИ( !ПУСТО( СистемаНО ), """taxationType"": """ + СистемаНО + """,", "") + "
		""ignoreNonFiscalPrintErrors"": false,
		""operator"": {
			""name"": """ + _ИМЯКАССИРА + """,
			""vatin"": """ + _ИННКАССИРА + """
			},";
	IF ( КомандыЧека.echeque )
	{
		ЗаголовокЭлектронногоЧека = ЕСЛИ( ПРАВСИМВ(ЗаголовокЧека,1) <> ",", ",", "") + "
		""electronically"": " + ЕСЛИ( КомандыЧека.echeque, "true", "false" ) + "";
		ЗаголовокЧека += ЗаголовокЭлектронногоЧека;
	}
	
	//покупатель
	НаименованиеКлиента = "";
	ИННКлиента 			= "";
	IF ( !ПУСТО( КомандыЧека.clientcode ) )
	{
		ДОБАВИТЬКОНТЕКСТ("SELECT priz, name, inn FROM sprclient WHERE code = '" + ALLTRIM(КомандыЧека.clientcode) + "'", "ДанныеКлиента", 1);
		ТипКлиента = VAL(ДанныеКлиента.priz);
		IF (ТипКлиента == 1 OR ТипКлиента == 3)
		{
			НаименованиеКлиента = ФР.XMLTRANS(ДанныеКлиента.name);
			ИННКлиента = ДанныеКлиента.inn;
		}
		УДАЛИТЬКОНТЕКСТ("ДанныеКлиента");
	}
				
	IF ( ПУСТО( ПОЧТА ) AND ПУСТО( КомандыЧека.clientcode ) )
	{
		ЗаголовокИнфоКлиента = "";
	}
	ELSE
	{
		ЗаголовокИнфоКлиента = ЕСЛИ( ПРАВСИМВ(ЗаголовокЧека,1) <> ",", ",", "") + "
		""clientInfo"": {";
		IF (!ПУСТО(ПОЧТА))
		{	
			ЗаголовокИнфоКлиента += "
			""emailOrPhone"": """ + ПОЧТА + """";
		}
		IF (!ПУСТО(НаименованиеКлиента))
		{
			ЗаголовокИнфоКлиента += ЕСЛИ(!ПУСТО(ПОЧТА),",","") + "
			""name"": """ + НаименованиеКлиента + """";
		}
		IF (!ПУСТО(ИННКлиента))
		{
			ЗаголовокИнфоКлиента += ",
			""vatin"": """ + ИННКлиента + """";
		}
		ЗаголовокИнфоКлиента += "
		},";	
	}
	ЗаголовокЧека += ЗаголовокИнфоКлиента;
}
RETURN ЗаголовокЧека;
