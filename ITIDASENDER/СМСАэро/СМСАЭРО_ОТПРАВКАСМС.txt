АдресСервераСМС = "https://gate.smsaero.ru";
АдресРесурса = "/v2/sms/send?number=<phone>&text=<message>&sign=<sender>";

IF (TYPE("_СМСАЭРОЛОГИН") == "C")
	ЛОГИН = _СМСАЭРОЛОГИН;
ELSE
{
	СООБЩЕНИЕ("Необходимо создать константу _СМСАЭРОЛОГИН и указать в ней логин от аккаунта SMSAero");
	RETURN false;
}

IF (ПУСТО(ЛОГИН))
{
	СООБЩЕНИЕ("Не указан логин для аккаунта SMSAero (Константа _СМСАЭРОЛОГИН)");
}

IF (TYPE("_СМСАЭРОТОКЕН") == "C")
	ПАРОЛЬ = _СМСАЭРОТОКЕН;
ELSE
{
	СООБЩЕНИЕ("Необходимо создать константу _СМСАЭРОТОКЕН и указать в ней токен для аккаунта SMSAero");
	RETURN false;
}
	
IF (ПУСТО(ПАРОЛЬ))
{
	СООБЩЕНИЕ("Не указан пароль для аккаунта SMSAero (Константа _СМСАЭРОТОКЕН)");
}

//СтрокаАвторизации = ITIDASENDER.URLENCODING(ЛОГИН + ":" ) + ПАРОЛЬ;
СтрокаАвторизации = ЛОГИН + ":" + ПАРОЛЬ;
//АдресСервераСМС = STRTRANC(АдресСервераСМС,"email:api_key",СтрокаАвторизации);

IF (ПУСТО(НОМЕРАКЛИЕНТОВ))
{
	СООБЩЕНИЕ("Не указаны адреса для отправки СМС");
	RETURN false;
}
ELSE
{
	//проверим наличие запятой в номерах, что будет говорить о рассылке на более чем 1 номер
	IF ( ATC(НОМЕРАКЛИЕНТОВ,",",) > 0 )
	{
		СтрокаСНомерами = "";
		НОМЕРАДЛЯОТПРАВКИ = "," + НОМЕРАКЛИЕНТОВ;
		номерслова = 1;
		НОМЕРКЛИЕНТА = ПОЛУЧИТЬСЛОВО(НОМЕРАДЛЯОТПРАВКИ,",",",", номерслова);
		WHILE (!ПУСТО(НОМЕРКЛИЕНТА))
		{
			СтрокаСНомерами += ЕСЛИ(!ПУСТО(СтрокаСНомерами),"&","") + "numbers[]=" + НОМЕРКЛИЕНТА;
			номерслова++;
			НОМЕРКЛИЕНТА = ПОЛУЧИТЬСЛОВО(НОМЕРАДЛЯОТПРАВКИ,",",",", номерслова);
		}
		АдресРесурса = STRTRANC(АдресРесурса,"number=<phone>",СтрокаСНомерами);
	}
	ELSE
		АдресРесурса = STRTRANC(АдресРесурса,"<phone>",НОМЕРАКЛИЕНТОВ);
}

IF (ПУСТО(ТЕКСТСООБЩЕНИЯ))
{
	СООБЩЕНИЕ("Не указан текст сообщения для отправки");
	RETURN false;
}
ELSE
{
	АдресРесурса = STRTRANC(АдресРесурса,"<message>", ТЕКСТСООБЩЕНИЯ);
}

ИМЯОТПРАВИТЕЛЯ = "";
IF (TYPE("_СМСАЭРОИМЯОТПРАВИТЕЛЯ") == "C")
	ИМЯОТПРАВИТЕЛЯ = _СМСАЭРОИМЯОТПРАВИТЕЛЯ;
	
//если не указан отправитель, то не заполняем данный параметр
IF (ПУСТО(ИМЯОТПРАВИТЕЛЯ))
	АдресРесурса = STRTRANC(АдресРесурса,"<sender>","SMS Aero");
ELSE
	АдресРесурса = STRTRANC(АдресРесурса,"<sender>",ИМЯОТПРАВИТЕЛЯ);


//ОТВЕТ = ITIDASENDER.СМСАЭРО_HTTPPOST(АдресСервераСМС, АдресРесурса, "", "", СтрокаАвторизации);
ОТВЕТ = ITIDASENDER.СМСАЭРО_HTTPGET(АдресСервераСМС, АдресРесурса, "", СтрокаАвторизации);

IF (!ПУСТО(ОТВЕТ))
	RETURN true;
ELSE
	RETURN false;
